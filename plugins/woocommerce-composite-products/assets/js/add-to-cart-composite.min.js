function wc_cp_toggle_element(t,e,i){return!0!==t.data("animating")&&(t.hasClass("closed")?(setTimeout(function(){e.slideDown({duration:300,queue:!1,always:function(){t.data("animating",!1),"function"==typeof i&&i()}})},40),t.removeClass("closed").addClass("open"),t.data("animating",!0)):(setTimeout(function(){e.slideUp({duration:300,queue:!1,always:function(){t.data("animating",!1),"function"==typeof i&&i()}})},40),t.removeClass("open").addClass("closed"),t.data("animating",!0)),!0)}function wc_cp_price_format(t,e){return e=void 0!==e&&e,wc_cp_woocommerce_number_format(wc_cp_number_format(t),e)}function wc_cp_woocommerce_number_format(t,e){var i=wc_composite_params.currency_format_decimal_sep,n=wc_composite_params.currency_position,o=wc_composite_params.currency_symbol,s=wc_composite_params.currency_format_trim_zeros,a=wc_composite_params.currency_format_num_decimals;if(e=void 0!==e&&e,"yes"==s&&a>0){for(var _=0;_<a;_++)i+="0";t=t.replace(i,"")}var c=String(t),d=e?o:'<span class="woocommerce-Price-currencySymbol">'+o+"</span>";return"left"===n?c=d+c:"right"===n?c+=d:"left_space"===n?c=d+" "+c:"right_space"===n&&(c=c+" "+d),c=e?c:'<span class="woocommerce-Price-amount amount">'+c+"</span>"}function wc_cp_number_format(t){var e=wc_composite_params.currency_format_num_decimals,i=wc_composite_params.currency_format_decimal_sep,n=wc_composite_params.currency_format_thousand_sep,o=t,s=isNaN(e=Math.abs(e))?2:e,a=void 0===i?",":i,_=void 0===n?".":n,c=o<0?"-":"",d=parseInt(o=Math.abs(+o||0).toFixed(s))+"",r=(r=d.length)>3?r%3:0;return c+(r?d.substr(0,r)+_:"")+d.substr(r).replace(/(\d{3})(?=\d)/g,"$1"+_)+(s?a+Math.abs(o-d).toFixed(s).slice(2):"")}function wc_cp_number_round(t,e){var i=void 0===e?wc_composite_params.currency_format_num_decimals:e,n=Math.pow(10,parseInt(i)),o=t*n;return Math.round(o)/n}function wc_cp_join(t){var e="",i=t.length;if(i>0)for(var n=0,o=0;o<i;o++)n++,e=1==i||1==n?t[o]:wc_composite_params.i18n_comma_sep.replace("%s",e).replace("%v",t[o]);return e}function wc_cp_get_variation_data(t,e){e=void 0!==e&&e;var i=t.find(".attribute-options"),n=i.length,o=[],s="";return 0===n?"":(i.each(function(t){var e=jQuery(this);if(""===e.find("select").val())return o=[],s="",!1;var i=e.data("attribute_label"),a=e.find("select option:selected").text();o.push({meta_key:i,meta_value:a}),s=s+'<span class="meta_element"><span class="meta_key">'+i+':</span> <span class="meta_value">'+a+"</span>",t!==n-1&&(s+='<span class="meta_element_sep">, </span>'),s+="</span>"}),e?s:o)}var wc_cp_composite_scripts={},$wc_cp_body=!1,$wc_cp_html=jQuery("html"),$wc_cp_window=jQuery(window),$wc_cp_document=jQuery(document),wc_cp_block_params={message:null,fadeIn:0,fadeOut:0,overlayCSS:{background:"rgba( 255, 255, 255, 0 )",opacity:1}},wc_cp_block_wait_params={message:null,fadeIn:200,fadeOut:200,overlayCSS:{background:"rgba( 255, 255, 255, 0 )",opacity:.6}};jQuery.fn.wc_cp_is_in_viewport=function(t,e,i){var n=$wc_cp_window;if(!(this.length<1)){var o=this.length>1?this.eq(0):this,s=o.get(0),a=n.width(),_=n.height(),c=!0!==e||s.offsetWidth*s.offsetHeight;if(i=i||"vertical","function"==typeof s.getBoundingClientRect){var d=s.getBoundingClientRect(),r=d.top>=0&&d.top<_,l=d.bottom>0&&d.bottom<=_,p=d.left>=0&&d.left<a,u=d.right>0&&d.right<=a,m=t?r||l:r&&l,h=t?p||u:p&&u;if("both"===i)return c&&m&&h;if("vertical"===i)return c&&m;if("horizontal"===i)return c&&h}else{var g=n.scrollTop(),v=g+_,f=n.scrollLeft(),b=f+a,w=o.offset(),y=w.top,$=y+o.height(),k=w.left,x=k+o.width(),C=!0===t?$:y,q=!0===t?y:$,z=!0===t?x:k,S=!0===t?k:x;if("both"===i)return!!c&&q<=v&&C>=g&&S<=b&&z>=f;if("vertical"===i)return!!c&&q<=v&&C>=g;if("horizontal"===i)return!!c&&S<=b&&z>=f}}},jQuery.fn.wc_get_composite_script=function(){var t=jQuery(this);if(!t.hasClass("composite_form"))return!1;var e=t.data("script_id");return void 0!==wc_cp_composite_scripts[e]&&wc_cp_composite_scripts[e]},function(t,e){function i(i){var o=this;this.composite_id=i.$composite_data.data("container_id"),this.$composite_data=i.$composite_data,this.$composite_form=i.$composite_form,this.$composite_add_to_cart_button=i.$composite_form.find(".composite_add_to_cart_button"),this.$composite_navigation=i.$composite_form.find(".composite_navigation"),this.$composite_navigation_top=i.$composite_form.find(".composite_navigation.top"),this.$composite_navigation_bottom=i.$composite_form.find(".composite_navigation.bottom"),this.$composite_navigation_movable=i.$composite_form.find(".composite_navigation.movable"),this.$composite_pagination=i.$composite_form.find(".composite_pagination"),this.$composite_summary=i.$composite_form.find(".composite_summary"),this.$composite_summary_widget=t(".widget_composite_summary").filter(function(){return t(this).find(".widget_composite_summary_content_"+o.composite_id).length>0}),this.$components=i.$composite_form.find(".component"),this.$steps={},this.$composite_availability=i.$composite_data.find(".composite_availability"),this.$composite_price=i.$composite_data.find(".composite_price"),this.$composite_message=i.$composite_data.find(".composite_message"),this.$composite_button=i.$composite_data.find(".composite_button"),this.$composite_quantity=this.$composite_button.find("input.qty"),this.$composite_status=i.$composite_form.find(".composite_status"),this.$composite_transition_helper=i.$composite_form.find(".scroll_show_component"),this.$composite_form_blocker=i.$composite_form.find(".form_input_blocker"),this.timers={on_resize_timer:!1},this.ajax_url="yes"===wc_composite_params.use_wc_ajax?woocommerce_params.wc_ajax_url:woocommerce_params.ajax_url,this.debug_tab_count=0,this.settings=i.$composite_data.data("composite_settings"),this.is_initialized=!1,this.has_transition_lock=!1,this.steps=[],this.step_factory=new n.WC_CP_Step_Factory,this.scenarios=new n.WC_CP_Scenarios_Manager(this),this.actions=new n.WC_CP_Actions_Dispatcher(this),this.filters=new n.WC_CP_Filters_Manager,this.router=!1,this.data_model=!1,this.view_classes=new n.WC_CP_Views(this),this.model_classes=new n.WC_CP_Models(this),this.composite_viewport_scroller=!1,this.composite_summary_view=!1,this.composite_pagination_view=!1,this.composite_navigation_view=!1,this.composite_validation_view=!1,this.composite_availability_view=!1,this.composite_price_view=!1,this.composite_add_to_cart_button_view=!1,this.composite_summary_widget_views=[],this.api={navigate_to_step:function(t){var e=o.get_step_by("id",t);if(!1===e)return!1;o.navigate_to_step(e)},show_previous_step:function(){o.show_previous_step()},show_next_step:function(){o.show_next_step()},get_steps:function(){return o.get_steps()},get_components:function(){return o.get_components()},get_step:function(t){return o.get_step(t)},get_step_by:function(t,e){return o.get_step_by(t,e)},get_step_title:function(t){var e=o.get_step_by("id",t);return!1!==e&&e.get_title()},get_step_slug:function(t){var e=o.get_step_by("id",t);return!1!==e&&e.step_slug},get_current_step:function(){return o.get_current_step()},get_previous_step:function(){return o.get_previous_step()},get_next_step:function(){return o.get_next_step()},get_composite_totals:function(){return o.data_model.get("totals")},get_composite_stock_status:function(){return o.data_model.get("is_in_stock")?"in-stock":"out-of-stock"},get_composite_availability:function(){var t=o.composite_availability_view.get_components_availability_string();return""===t&&!1!==o.composite_availability_view.$composite_stock_status&&(t=o.composite_availability_view.$composite_stock_status.clone().wrap("<div></div>").parent().html()),t},get_composite_validation_status:function(){return o.data_model.get("passes_validation")?"pass":"fail"},get_composite_validation_messages:function(){return o.data_model.get("validation_messages")},get_composite_configuration:function(){var e={};return 0!==o.get_components().length&&(t.each(o.get_components(),function(t,i){var n=o.api.get_component_configuration(i.component_id);e[i.component_id]=n}),e)},get_component_totals:function(t){return!1!==o.get_step_by("id",t)&&o.data_model.get("component_"+t+"_totals")},get_component_stock_status:function(t){var e=o.get_step_by("id",t);return!1!==e&&(e.step_validation_model.get("is_in_stock")?"in-stock":"out-of-stock")},get_component_availability:function(t){var e=o.get_step_by("id",t);if(!1===e)return!1;var i=e.$component_summary_content.find(".component_wrap .stock");return i.length>0?i.clone().wrap("<div></div>").parent().html():""},get_component_validation_status:function(t){var e=o.get_step_by("id",t);return!1!==e&&(e.step_validation_model.get("passes_validation")?"pass":"fail")},get_component_validation_messages:function(t,e){var i=o.get_step_by("id",t);return!1!==i&&("composite"===e?i.step_validation_model.get("composite_messages"):i.step_validation_model.get("component_messages"))},get_component_configuration:function(t){var e=o.get_step_by("id",t),i=!1;return!1===e?i:(i={title:e.get_title(),selection_title:e.get_selected_product_title(!1),selection_meta:e.get_selected_product_meta(!1),product_id:e.get_selected_product(!1),variation_id:e.get_selected_variation(!1),product_valid:e.is_selected_product_valid(),variation_valid:e.is_selected_variation_valid(),quantity:e.get_selected_quantity(),product_type:e.get_selected_product_type()},i=o.filters.apply_filters("component_configuration",[i,e]))},is_priced_per_product:function(){o.console_log("error","\nMethod 'WC_CP_Composite::api::is_priced_per_product' is deprecated since v3.7.0. Use 'WC_CP_Composite::api::is_component_priced_individually' instead.")},is_component_priced_individually:function(t){return"yes"===o.data_model.price_data.is_priced_individually[t]}},this.init=function(){o.$composite_data.trigger("wc-composite-initializing",[o]),this.actions.add_action("initialize_composite",function(){o.init_steps()},10,this).add_action("initialize_composite",function(){o.init_models()},20,this).add_action("initialize_composite",function(){o.actions.init()},30,this).add_action("initialize_composite",function(){o.on_resize_handler()},40,this).add_action("initialize_composite",function(){o.init_views()},50,this).add_action("initialize_composite",function(){o.scenarios.init()},60,this).add_action("initialize_composite",function(){o.console_log("debug:events","\nValidating Steps:"),o.debug_tab_count=o.debug_tab_count+2,t.each(o.get_steps(),function(t,e){e.validate()}),o.debug_tab_count=o.debug_tab_count-2,o.console_log("debug:events","\nValidation complete.")},70,this).add_action("initialize_composite",function(){o.get_current_step().show_step()},80,this).add_action("initialize_composite",function(){o.init_router()},90,this),this.actions.do_action("initialize_composite"),o.is_initialized=!0,this.actions.add_action("composite_initialized",function(){o.data_model.init()},10,this).add_action("composite_initialized",function(){o.render_views()},20,this),this.actions.do_action("composite_initialized")},this.init_router=function(){var t=o.get_current_step(),i=e.Router.extend({has_initial_route:!1,is_initialized:!1,routes:{":step_slug":"show_step"},show_step:function(t){var e=encodeURIComponent(t),i=o.get_step_by("slug",e);i&&(this.is_initialized||(this.has_initial_route=!0),i.is_locked()?(window.alert(wc_composite_params.i18n_step_not_accessible.replace(/%s/g,i.get_title())),o.router.navigate(o.get_current_step().step_slug)):(this.is_initialized&&o.composite_viewport_scroller.scroll_viewport(o.$composite_form,{timeout:0,partial:!1,duration:0,queue:!1}),i.show_step()))}});$wc_cp_body.hasClass("single-product")&&$wc_cp_body.hasClass("postid-"+o.composite_id)&&!1===o.$composite_form.parent().hasClass("quick-view-content")&&(o.router=new i,e.history.start(),o.router.is_initialized=!0,"single"===o.settings.layout||!1!==o.router.has_initial_route||window.location.hash||o.router.navigate(t.step_slug,{trigger:!1}))},this.init_steps=function(){o.console_log("debug:events","\nInitializing Steps..."),"paged"===o.settings.layout?"componentized"===o.settings.layout_variation?(o.$composite_form.find(".multistep.active").removeClass("active"),o.$composite_data.addClass("multistep active"),o.$composite_summary_widget.hide()):o.$composite_data.prev().hasClass("multistep")?(o.$composite_data.addClass("multistep"),o.$composite_data.hide(),o.$composite_data.hasClass("composite_added_to_cart")&&(o.$composite_form.find(".multistep.active").removeClass("active"),o.$composite_data.addClass("active"))):(o.$composite_data.show(),o.$composite_data.find(".component_title .step_index").hide()):"progressive"===o.settings.layout?(o.$components.show(),o.$composite_data.show()):"single"===o.settings.layout&&(o.$components.show(),o.$composite_data.show()),o.$steps=o.$composite_form.find(".multistep"),o.$composite_form.children(".component, .multistep").each(function(e){var i=o.step_factory.create_step(o,t(this),e);o.steps[e]=i}),o.$composite_navigation.removeAttr("style")},this.get_ajax_url=function(t){return"yes"===wc_composite_params.use_wc_ajax?this.ajax_url.toString().replace("%%endpoint%%",t):this.ajax_url},this.navigate_to_step=function(t){"object"==typeof t&&"function"==typeof t.show_step&&(t.show_step(),this.allow_history_updates()&&this.router.navigate(t.step_slug))},this.allow_history_updates=function(){return!1!==o.router&&"yes"===this.settings.update_browser_history&&o.is_initialized},this.show_previous_step=function(){t.each(o.get_steps(),function(t,e){if(e.is_previous())return o.navigate_to_step(e),!1})},this.show_next_step=function(){t.each(o.get_steps(),function(t,e){if(e.is_next())return o.navigate_to_step(e),!1})},this.get_steps=function(){return this.steps},this.get_components=function(){var e=[];return t.each(this.steps,function(t,i){i.is_component()&&e.push(i)}),e},this.get_step=function(e){var i=!1;return t.each(o.get_steps(),function(t,n){if(n.step_id==e)return i=n,!1}),i},this.get_step_by=function(e,i){var n=!1;return("id"===e||"index"===e||"slug"===e)&&(t.each(o.get_steps(),function(t,o){if("id"===e&&String(o.step_id)===String(i)||"index"===e&&String(t)===String(i)||"slug"===e&&String(o.step_slug).toUpperCase()===String(i).toUpperCase())return n=o,!1}),n)},this.get_current_step=function(){var e=!1;return t.each(o.get_steps(),function(t,i){if(i.is_current())return e=i,!1}),e},this.set_current_step=function(e){var i=this.settings.layout,n=this.settings.layout_variation,o=this.get_current_step(),s=this.get_next_step(),a=this.get_previous_step(),_=!1,c=!1;"paged"===i&&"componentized"===n?_=c=this.get_step_by("id","review"):t.each(this.get_steps(),function(t,i){!1===_&&i.step_index>e.step_index&&i.is_visible()&&(_=i),i.step_index<e.step_index&&i.is_visible()&&(c=i)}),o._is_current=!1,e._is_current=!0,o.$el.removeClass("active"),e.$el.addClass("active"),!1!==s&&(s._is_next=!1,s.$el.removeClass("next")),!1!==_&&(_._is_next=!0,_.$el.addClass("next")),!1!==a&&(a._is_previous=!1,a.$el.removeClass("prev")),!1!==c&&(c._is_previous=!0,c.$el.addClass("prev"))},this.get_previous_step=function(){var e=!1;return t.each(o.get_steps(),function(t,i){if(i.is_previous())return e=i,!1}),e},this.get_next_step=function(){var e=!1;return t.each(o.get_steps(),function(t,i){if(i.is_next())return e=i,!1}),e},this.on_resize_handler=function(){var e=o.$composite_form.width();e<=wc_composite_params.small_width_threshold?o.$composite_form.addClass("small_width"):o.$composite_form.removeClass("small_width"),e>wc_composite_params.full_width_threshold?o.$composite_form.addClass("full_width"):o.$composite_form.removeClass("full_width"),wc_composite_params.legacy_width_threshold&&(e<=wc_composite_params.legacy_width_threshold?o.$composite_form.addClass("legacy_width"):o.$composite_form.removeClass("legacy_width")),o.is_initialized&&t.each(o.get_components(),function(t,e){if(e.component_selection_view.is_relocated()){var i=e.component_selection_view.get_new_relocation_data();if(i.relocate){var n=e.component_selection_view.$relocation_target;i.reference.after(n)}}})},this.console_log=function(e,i){if(window.console&&void 0!==i){var n=!1;if("error"===e?n=!0:_.contains(wc_composite_params.script_debug_level,e)?n=!0:t.each(wc_composite_params.script_debug_level,function(t,i){if(e.indexOf(i)>-1)return n=!0,!1}),n){var s="";if("error"!==e)for(var a=o.debug_tab_count;a>0;a--)s+="\t";i="function"==typeof i.substring&&"\n"===i.substring(0,1)?i.replace("\n","\n"+s):s+i,window.console.log(i)}}},this.init_models=function(){t.each(o.get_steps(),function(t,e){e.step_validation_model=new o.model_classes.Step_Validation_Model(e),e.step_visibility_model=new o.model_classes.Step_Visibility_Model(e),e.step_access_model=new o.model_classes.Step_Access_Model(e)}),t.each(o.get_components(),function(t,e){e.component_options_model=new o.model_classes.Component_Options_Model(e),e.component_selection_model=new o.model_classes.Component_Selection_Model(e)}),o.data_model=new o.model_classes.Composite_Data_Model},this.init_views=function(){o.console_log("debug:events","\nInitializing Views..."),this.composite_validation_view=new o.view_classes.Composite_Validation_View({is_in_widget:!1,el:o.$composite_message,model:o.data_model}),this.composite_price_view=new o.view_classes.Composite_Price_View({is_in_widget:!1,el:o.$composite_price,model:o.data_model}),this.composite_availability_view=new o.view_classes.Composite_Availability_View({is_in_widget:!1,el:o.$composite_availability,model:o.data_model}),this.composite_add_to_cart_button_view=new o.view_classes.Composite_Add_To_Cart_Button_View({is_in_widget:!1,el:o.$composite_button,$el_button:o.$composite_add_to_cart_button,model:o.data_model}),this.composite_status_view=new o.view_classes.Composite_Status_View({el:o.$composite_status,$el_content:o.$composite_status.find(".wrapper"),model:o.data_model}),o.$composite_pagination.length>0&&(o.composite_pagination_view=new o.view_classes.Composite_Pagination_View({el:o.$composite_pagination})),o.$composite_summary.length>0&&(o.composite_summary_view=new o.view_classes.Composite_Summary_View({is_in_widget:!1,el:o.$composite_summary})),o.$composite_navigation.length>0&&(o.composite_navigation_view=new o.view_classes.Composite_Navigation_View({el:o.$composite_navigation})),o.$composite_summary_widget.length>0&&o.$composite_summary_widget.each(function(t,e){o.composite_summary_widget_views.push(new o.view_classes.Composite_Widget_View({widget_count:t+1,el:e}))}),o.composite_viewport_scroller=new o.view_classes.Composite_Viewport_Scroller,t.each(o.get_steps(),function(t,e){e.validation_view=new o.view_classes.Step_Validation_View(e,{el:e.$component_message,model:e.step_validation_model}),e.step_title_view=new o.view_classes.Step_Title_View(e,{el:e.$step_title})}),t.each(o.get_components(),function(t,e){e.component_options_view=new o.view_classes.Component_Options_View(e,{el:e.$component_options,model:e.component_options_model}),e.component_pagination_view=new o.view_classes.Component_Pagination_View(e,{el:e.$component_pagination,model:e.component_options_model}),e.component_selection_view=new o.view_classes.Component_Selection_View(e,{el:e.$component_content,model:e.component_selection_model})}),t.each(o.get_components(),function(t,e){e.component_selection_view.init_dependencies()})},this.render_views=function(){o.console_log("debug:views","\nRendering Views..."),o.debug_tab_count=o.debug_tab_count+2,t.each(o.get_components(),function(t,e){e.component_options_view.render(),e.component_pagination_view.render(),e.component_selection_view.update_selection_title()}),t.each(o.get_steps(),function(t,e){e.step_title_view.render_navigation_state(),e.step_title_view.render_index()}),!1!==o.composite_pagination_view&&o.composite_pagination_view.render(),!1!==o.composite_summary_view&&o.composite_summary_view.render(),!1!==o.composite_navigation_view&&o.composite_navigation_view.render("transition"),t.each(o.composite_summary_widget_views,function(t,e){e.composite_summary_view.render()}),o.debug_tab_count=o.debug_tab_count-2,o.console_log("debug:views","\nRendering complete."),o.$composite_form.removeClass("cp-no-js"),o.$composite_form.find(".cp-no-js-msg").remove()},this.block=function(t){this.$composite_form.block(wc_cp_block_params),t.block(wc_cp_block_wait_params),o.has_transition_lock=!0},this.unblock=function(t){this.$composite_form.unblock(),t.unblock(),o.has_transition_lock=!1}}var n={};n.WC_CP_Models=function(i){this.Composite_Data_Model=function(n){return new(e.Model.extend({price_data:i.$composite_data.data("price_data"),$nyp:!1,initialize:function(){var e={passes_validation:!0,validation_messages:[],status_messages:[],is_in_stock:!0,stock_statuses:[],totals:{price:"",regular_price:"",price_incl_tax:"",price_excl_tax:""}};t.each(i.get_components(),function(t,i){e["component_"+i.component_id+"_totals"]={price:"",regular_price:"",price_incl_tax:"",price_excl_tax:""}}),this.set(e),this.price_data.suffix_exists=""!==wc_composite_params.price_display_suffix,this.price_data.suffix_contains_price_incl=wc_composite_params.price_display_suffix.indexOf("{price_including_tax}")>-1,this.price_data.suffix_contains_price_excl=wc_composite_params.price_display_suffix.indexOf("{price_excluding_tax}")>-1,i.actions.add_action("component_addons_changed",this.addons_changed_handler,10,this),i.actions.add_action("component_nyp_changed",this.nyp_changed_handler,10,this),i.actions.add_action("component_quantity_changed",this.quantity_changed_handler,20,this),i.actions.add_action("component_selection_changed",this.selection_changed_handler,30,this),i.actions.add_action("component_selection_content_changed",this.selection_content_changed_handler,30,this),i.actions.add_action("component_availability_changed",this.availability_changed_handler,10,this),i.actions.add_action("component_validation_message_changed",this.validation_message_changed_handler,10,this),i.actions.add_action("component_totals_changed",this.component_totals_changed_handler,10,this);var n=i.$composite_data.find(".nyp");n.length>0&&(this.$nyp=n,this.price_data.base_price=n.data("price"),i.$composite_data.on("woocommerce-nyp-updated-item",{model:this},function(t){var e=t.data.model;e.price_data.base_price=e.$nyp.data("price"),e.price_data.base_regular_price=e.$nyp.data("price"),e.calculate_totals()}))},init:function(){i.console_log("debug:models","\nInitializing composite data model..."),i.debug_tab_count=i.debug_tab_count+2,this.update_validation(),this.update_totals(),this.update_availability(),i.debug_tab_count=i.debug_tab_count-2},addons_changed_handler:function(t){if(!i.is_initialized)return!1;this.update_totals(t)},nyp_changed_handler:function(t){if(!i.is_initialized)return!1;this.update_totals(t)},selection_changed_handler:function(){if(!i.is_initialized)return!1;this.update_totals()},availability_changed_handler:function(){if(!i.is_initialized)return!1;this.update_availability()},selection_content_changed_handler:function(){if(!i.is_initialized)return!1;this.update_totals()},quantity_changed_handler:function(t){if(!i.is_initialized)return!1;this.update_totals(t)},validation_message_changed_handler:function(){this.update_validation()},component_totals_changed_handler:function(){this.calculate_totals()},update_validation:function(){var t=[];this.is_purchasable()?t=this.get_validation_messages():t.push(wc_composite_params.i18n_unavailable_text),i.console_log("debug:models","\nUpdating 'Composite_Data_Model' validation state... Attribute count: \"validation_messages\": "+t.length+', Attribute: "passes_validation": '+(0===t.length).toString()),i.debug_tab_count=i.debug_tab_count+2,this.set({validation_messages:t,passes_validation:0===t.length}),i.debug_tab_count=i.debug_tab_count-2},get_validation_messages:function(){var e=[];t.each(i.get_steps(),function(i,n){var o=n.get_title();t.each(n.get_validation_messages("composite"),function(i,s){if(n.is_review())e.push({sources:!1,content:s.toString()});else{var a=!1;e.length>0&&t.each(e,function(t,i){if(i.content===s){var n=i.sources,_=i.content;return n.push(o),e[t]={sources:n,content:_},a=!0,!1}}),a||e.push({sources:[o],content:s.toString()})}})});var n=[];return e.length>0&&t.each(e,function(t,e){if(!1===e.sources)n.push(e.content);else{var i=wc_cp_join(e.sources);n.push(wc_composite_params.i18n_validation_issues_for.replace("%c",i).replace("%e",e.content))}}),n=i.filters.apply_filters("composite_validation_messages",[n])},is_purchasable:function(){return"no"!==this.price_data.is_purchasable},get_quantity:function(){return i.$composite_quantity.length>0?parseInt(i.$composite_quantity.val()):1},update_availability:function(){var e=[],n=!0;t.each(i.get_components(),function(t,i){e.push(i.step_validation_model.get("is_in_stock"))}),n=!_.contains(e,!1),i.console_log("debug:models","\nUpdating 'Composite_Data_Model' availability... Attribute: \"stock_statuses\": "+e.toString()+', Attribute: "is_in_stock": '+n.toString()),i.debug_tab_count=i.debug_tab_count+2,this.set({stock_statuses:e,is_in_stock:n}),i.debug_tab_count=i.debug_tab_count-2},update_totals:function(e){var n=this;i.console_log("debug:models","\nUpdating 'Composite_Data_Model' totals..."),i.debug_tab_count=i.debug_tab_count+2,void 0===e?(t.each(i.get_components(),function(t,e){n.update_component_prices(e)}),this.calculate_subtotals()):(this.update_component_prices(e),this.calculate_subtotals(e)),i.debug_tab_count=i.debug_tab_count-2},get_taxed_totals:function(t,e,i,n){var o={price:(n=void 0===n?1:n)*t,regular_price:n*e,price_incl_tax:n*t,price_excl_tax:n*t};return i>0&&("yes"===wc_composite_params.prices_include_tax?o.price_excl_tax=wc_cp_number_round(o.price/i):o.price_incl_tax=wc_cp_number_round(o.price*i),"incl"===wc_composite_params.tax_display_shop?(o.price=o.price_incl_tax,"yes"!==wc_composite_params.prices_include_tax&&(o.regular_price=wc_cp_number_round(o.regular_price*i))):(o.price=o.price_excl_tax,"yes"===wc_composite_params.prices_include_tax&&(o.regular_price=wc_cp_number_round(o.regular_price/i)))),o},calculate_totals:function(e){var n=this,o=void 0===e?n.price_data:e;i.console_log("debug:models","\nAdding totals...");var s={price:o.base_price_totals.price,regular_price:o.base_price_totals.regular_price,price_incl_tax:o.base_price_totals.price_incl_tax,price_excl_tax:o.base_price_totals.price_excl_tax};return o.base_display_price=s.price,t.each(i.get_components(),function(t,i){var o=void 0===e?n.get("component_"+i.component_id+"_totals"):e["component_"+i.component_id+"_totals"];s.price+=o.price,s.regular_price+=o.regular_price,s.price_incl_tax+=o.price_incl_tax,s.price_excl_tax+=o.price_excl_tax}),s=i.filters.apply_filters("composite_totals",[s]),void 0===e&&(i.debug_tab_count=i.debug_tab_count+2,this.set({totals:s}),i.debug_tab_count=i.debug_tab_count-2),s},calculate_subtotals:function(e,n,o){var s=this,a=void 0===n?s.price_data:n;if(o=void 0===o?1:parseInt(o),!1===(e=void 0!==e&&e)){var _=Number(a.base_price),c=Number(a.base_regular_price),d=Number(a.base_price_tax);a.base_price_totals=this.get_taxed_totals(_,c,d,o)}if(t.each(i.get_components(),function(t,_){if(!1!==e&&e.component_id!==_.component_id)return!0;var c=a.quantities[_.component_id]*o,d="variable"===_.get_selected_product_type()?_.get_selected_variation(!1):_.get_selected_product(!1),r=a.prices_tax[_.component_id],l=a.regular_prices[_.component_id]+a.addons_prices[_.component_id],p=a.prices[_.component_id]+a.addons_prices[_.component_id],u={price:0,regular_price:0,price_incl_tax:0,price_excl_tax:0};i.console_log("debug:models",'Calculating "'+_.get_title()+'" totals...'),"yes"===wc_composite_params.calc_taxes?d>0&&c>0&&(p>0||l>0)&&(u=s.get_taxed_totals(p,l,r,c)):(u.price=c*p,u.regular_price=c*l,u.price_incl_tax=c*p,u.price_excl_tax=c*p),u=i.filters.apply_filters("component_totals",[u,_]),void 0===n?(i.console_log("debug:models","Updating 'Composite_Data_Model' component totals... Attribute: \"component_"+_.component_id+'_totals".'),i.debug_tab_count=i.debug_tab_count+2,s.set("component_"+_.component_id+"_totals",u),i.debug_tab_count=i.debug_tab_count-2):a["component_"+_.component_id+"_totals"]=u}),void 0!==n)return a},update_component_prices:function(t){i.console_log("debug:models",'Fetching "'+t.get_title()+'" price data...');var e=t.get_selected_quantity(),n=t.$component_data.data("custom");this.price_data.prices[t.component_id]=Number(t.$component_data.data("price")),this.price_data.regular_prices[t.component_id]=Number(t.$component_data.data("regular_price")),this.price_data.prices_tax[t.component_id]=1,void 0!==n&&"undefined"!==n.price_tax&&(this.price_data.prices_tax[t.component_id]=Number(n.price_tax)),this.price_data.addons_prices[t.component_id]=Number(t.component_selection_model.get("selected_addons")),this.price_data.quantities[t.component_id]=e>0?parseInt(e):0},add_status_message:function(e,n){var o=t.extend(!0,[],this.get("status_messages"));o.push({message_source:e,message_content:n}),i.console_log("debug:models",'Adding "'+e+'" status message: "'+n+'"...'),this.set({status_messages:o})},remove_status_message:function(t){i.console_log("debug:models",'Removing "'+t+'" status message...');var e=_.filter(this.get("status_messages"),function(e){return e.message_source!==t});this.set({status_messages:e})}}))(n)},this.Step_Validation_Model=function(t,n){var o=t;return new(e.Model.extend({initialize:function(){var t={passes_validation:!0,is_in_stock:!0,component_messages:[],composite_messages:[]};this.set(t),i.actions.add_action("component_quantity_changed",this.quantity_changed_handler,10,this),i.actions.add_action("component_selection_changed",this.selection_changed_handler,20,this),i.actions.add_action("component_selection_content_changed",this.selection_content_changed_handler,20,this)},quantity_changed_handler:function(){i.is_initialized&&t.step_id===o.step_id&&o.validate()},selection_changed_handler:function(){i.is_initialized&&o.validate()},selection_content_changed_handler:function(t){i.is_initialized&&t.step_id===o.step_id&&o.validate()},update:function(t,e){var n={passes_validation:t,is_in_stock:e,component_messages:o.get_validation_messages("component"),composite_messages:o.get_validation_messages("composite")};i.console_log("debug:models","\nUpdating 'Step_Validation_Model': \""+o.get_title()+'", Attribute: "passes_validation": '+n.passes_validation.toString()+', Attribute: "is_in_stock": '+n.is_in_stock.toString()),this.get("passes_validation")!==n.passes_validation?i.console_log("debug:models","Validation state changed.\n"):i.console_log("debug:models","Validation state unchanged.\n"),_.isEqual(this.get("component_messages"),n.component_messages)?i.console_log("debug:models","Validation message unchanged.\n"):i.console_log("debug:models","Validation message changed.\n"),this.get("is_in_stock")!==n.is_in_stock?i.console_log("debug:models","Stock state changed.\n"):i.console_log("debug:models","Stock state unchanged.\n"),i.debug_tab_count=i.debug_tab_count+2,this.set(n),i.debug_tab_count=i.debug_tab_count-2}}))(n)},this.Step_Access_Model=function(n,o){var s=n;return new(e.Model.extend({is_lockable:!1,initialize:function(){var e=this,n={is_locked:!1};this.set(n),this.is_lockable="single"!==i.settings.layout&&("componentized"!==i.settings.layout_variation||"yes"===i.settings.sequential_componentized_progress&&!1===s.is_review()),this.is_lockable&&t.each(i.get_steps(),function(t,i){if(i.is_review())return!0;i.step_index<s.step_index&&(e.listenTo(i.step_validation_model,"change:passes_validation",e.update_lock_state),e.listenTo(i.step_access_model,"change:is_locked",e.update_lock_state))}),this.listenTo(s.step_visibility_model,"change:is_visible",this.update_lock_state)},update_lock_state:function(){var e=!1;!1===s.is_visible()?e=!0:this.is_lockable&&t.each(i.get_steps(),function(t,i){return i.step_index!==s.step_index&&(!1===i.is_visible()||(i.step_access_model.get("is_locked")?(e=!0,!1):!1===i.step_validation_model.get("passes_validation")?(e=!0,!1):void 0))}),i.console_log("debug:models","\nUpdating 'Step_Access_Model': \""+s.get_title()+'", Attribute: "is_locked": '+e.toString()),this.get("is_locked")!==e?i.console_log("debug:models","Lock state changed.\n"):i.console_log("debug:models","Lock state unchanged.\n"),i.debug_tab_count=i.debug_tab_count+2,this.set({is_locked:e}),i.debug_tab_count=i.debug_tab_count-2}}))(o)},this.Step_Visibility_Model=function(n,o){var s=n;return new(e.Model.extend({recursing:!1,initialize:function(){var t={is_visible:!0};this.set(t),s.is_component()&&i.actions.add_action("active_scenarios_changed",this.update_visibility_state,5,this)},update_visibility_state:function(){var e=i.scenarios.get_active_scenarios(),n=i.scenarios.filter_scenarios_by_type(e,"conditional_components"),o=!0;i.console_log("debug:models",'\nUpdating "'+s.get_title()+'" visibility...'),i.debug_tab_count=i.debug_tab_count+2,i.console_log("debug:models",'Active "Hide Components" Scenarios: ['+n+"]");var a=i.scenarios.get_scenario_data().scenario_settings.conditional_components;n.length>0&&void 0!==a&&t.each(a,function(t,e){_.contains(n,t.toString())&&_.contains(e,s.component_id.toString())&&(o=!1)}),i.console_log("debug:models","\nUpdating 'Step_Visibility_Model': \""+s.get_title()+'", Attribute: "is_visible": '+o.toString()),this.get("is_visible")!==o?i.console_log("debug:models","Visibility state changed.\n"):i.console_log("debug:models","Visibility state unchanged.\n"),i.debug_tab_count=i.debug_tab_count+2,this.recursing?i.console_log("error","\nStep visibility model recursion detected. Stepping out..."):(this.recursing=!0,this.set({is_visible:o})),this.recursing=!1,i.debug_tab_count=i.debug_tab_count-2,i.debug_tab_count=i.debug_tab_count-2}}))(o)},this.Component_Options_Model=function(n,o){var s=n;return new(e.Model.extend({available_options_data:[],xhr:!1,initialize:function(){this.available_options_data=s.find_options_data();var t=[];this.available_options_data.length>0&&(t=_.pluck(this.available_options_data,"option_id"));var e={filters:s.find_active_filters(),orderby:s.find_order_by(),page:s.find_pagination_param("page"),pages:s.find_pagination_param("pages"),available_options:t,active_options:t.slice(),options_state:{active:_.pluck(_.where(this.available_options_data,{is_in_view:!0}),"option_id"),inactive:[]},options_in_scenarios:i.scenarios.clean_masked_scenarios(i.scenarios.get_scenarios_by_type("compat_group"),s.component_id)};this.set(e),"single"===i.settings.layout?i.actions.add_action("active_scenarios_updated",this.refresh_options_state,10,this):(i.actions.add_action("active_scenarios_changed",this.refresh_options_state,10,this),i.actions.add_action("available_options_changed_"+s.step_id,this.available_options_changed_handler,10,this),i.actions.add_action("active_step_changed_"+s.step_id,this.active_step_changed_handler,10,this))},active_step_changed_handler:function(){this.refresh_options_state(s)},available_options_changed_handler:function(){this.refresh_options_state(s)},reload_options_on_scenarios_change:function(){var t=!1;return s.hide_disabled_products()&&s.has_options_style("thumbnails")&&s.get_max_results()>s.get_results_per_page()&&(!1===s.append_results()?t=!0:_.pluck(_.where(this.available_options_data,{is_in_view:!0}),"option_id").length<s.get_max_results()&&(t=!0)),t},request_options:function(e,n){var o=this;this.set(_.omit(e,"page"));var a={action:"woocommerce_show_component_options",component_id:s.component_id,composite_id:i.composite_id,load_page:e.page?e.page:1,selected_option:s.get_selected_product(!1),filters:this.get("filters"),orderby:this.get("orderby"),options_in_scenarios:this.reload_options_on_scenarios_change()?this.get("options_in_scenarios"):[]};this.xhr&&this.xhr.abort(),this.xhr=t.post(i.get_ajax_url(a.action),a,function(t){o.trigger("component_options_data_loaded",t,n),"success"===t.result?"reload"===n?(o.available_options_data=t.options_data,i.scenarios.set_component_scenario_data(s.component_id,t.scenario_data),o.set(t.pagination_data),o.refresh_options(_.pluck(o.available_options_data,"option_id"))):"append"===n&&(o.available_options_data=_.union(_.where(o.available_options_data,{is_in_view:!0}),_.map(t.options_data,function(t){return _.extend(t,{is_appended:!0})})),i.scenarios.merge_component_scenario_data(s.component_id,t.scenario_data),o.set(t.pagination_data),o.refresh_options(_.pluck(o.available_options_data,"option_id")),o.available_options_data=_.map(o.available_options_data,function(t){return _.omit(t,"is_appended")})):window.alert(t.message),i.actions.do_action("component_options_loaded",[s])},"json")},refresh_options:function(t){i.console_log("debug:models","\nUpdating 'Component_Options_Model': \""+s.get_title()+'", Attribute: "available_options": '+_.map(t,function(t){return""===t?"0":t})),i.debug_tab_count=i.debug_tab_count+2,_.isEqual(this.get("available_options"),t)?this.refresh_options_state(s):this.set({available_options:t}),i.debug_tab_count=i.debug_tab_count-2},refresh_options_state:function(e){i.console_log("debug:models","\nUpdating 'Component_Options_Model': \""+s.get_title()+'", Attribute: "active_options"...'),i.debug_tab_count=i.debug_tab_count+2;var n=[],o=[],a={active:[],inactive:[]},c=(e.step_index,s.component_id),d=i.scenarios.get_scenario_data().scenario_data[c],r=!1,l=!1,p=!1;if(e.is_review()&&1e3,!0,!0,o=i.scenarios.filter_scenarios_by_type(i.scenarios.calculate_active_scenarios(s,!0,!0),"compat_group"),i.console_log("debug:models","\nReference scenarios: ["+o+"]"),i.console_log("debug:models","Removing any scenarios where the current component is masked..."),0===(o=i.scenarios.clean_masked_scenarios(o,c)).length&&o.push("0"),i.console_log("debug:models","\nUpdating 'Component_Options_Model': \""+s.get_title()+'", Attribute: "options_in_scenarios"...'),_.isEqual(this.get("options_in_scenarios"),o)?i.console_log("debug:models","\nActive options scenarios unchanged - ["+this.get("options_in_scenarios")+"] => ["+o+"].\n"):i.console_log("debug:models","\nActive options scenarios changed - ["+this.get("options_in_scenarios")+"] => ["+o+"].\n"),i.debug_tab_count=i.debug_tab_count+2,this.set({options_in_scenarios:o}),i.debug_tab_count=i.debug_tab_count-2,0 in d){for(var u=d[0],m=0;m<u.length;m++){var h=u[m];if(t.inArray(h,o)>-1){r=!0;break}}a.inactive.push("")}else!1===s.is_visible()&&(r=!0);if(r&&(i.console_log("debug:models","Component set as optional."),n.push(""),a.active.push("")),t.each(this.available_options_data,function(e,_){var c=_.option_id,r=c in d?d[c]:[],p=!1;i.console_log("debug:models","Updating selection #"+c+":"),i.console_log("debug:models","\tSelection in scenarios: ["+r+"]");for(var u=0;u<r.length;u++){var m=r[u];if(t.inArray(m,o)>-1){p=!0;break}}p?(i.console_log("debug:models","\tSelection enabled."),n.push(c),_.is_in_view&&a.active.push(c)):(i.console_log("debug:models","\tSelection disabled."),_.is_in_view&&a.inactive.push(c),s.get_selected_product(!1)===c&&(l=!0)&&i.console_log("debug:models","\t--- Selection invalid."))}),"variable"===s.get_selected_product_type()){var g=s.get_selected_variation(),v=s.$component_data.data("product_variations");i.console_log("debug:models","\tChecking variations..."),g>0&&i.console_log("debug:models","\t\t--- Stored variation is #"+g);for(var f=0;f<v.length;f++){var b=v[f].variation_id,w=b in d?d[b]:[],y=!1;i.console_log("debug:models","\t\tChecking variation #"+b+":"),i.console_log("debug:models","\t\tSelection in scenarios: ["+w+"]");for(var $=0;$<w.length;$++){var k=w[$];if(t.inArray(k,o)>-1){y=!0;break}}y?(i.console_log("debug:models","\t\tVariation enabled."),n.push(b.toString()),a.active.push(b.toString())):(i.console_log("debug:models","\t\tVariation disabled."),a.inactive.push(b.toString()),s.get_selected_variation(!1).toString()===b.toString()&&(p=!0)&&i.console_log("debug:models","\t\t--- Selection invalid."))}}i.console_log("debug:models","Done.\n"),i.debug_tab_count=i.debug_tab_count-2,_.isEqual(this.get("active_options"),n)?i.console_log("debug:models","\nActive options unchanged - ["+_.map(this.get("active_options"),function(t){return""===t?"0":t})+"] => ["+_.map(n,function(t){return""===t?"0":t})+"].\n"):i.console_log("debug:models","\nActive options changed - ["+_.map(this.get("active_options"),function(t){return""===t?"0":t})+"] => ["+_.map(n,function(t){return""===t?"0":t})+"].\n"),i.debug_tab_count=i.debug_tab_count+2,this.set({active_options:n}),i.debug_tab_count=i.debug_tab_count-2,_.isEqual(this.get("options_state"),a)?i.console_log("debug:models","\nOptions state unchanged.\n"):i.console_log("debug:models","\nOptions state changed.\n"),i.debug_tab_count=i.debug_tab_count+2,this.set({options_state:a}),i.debug_tab_count=i.debug_tab_count-2,("single"===i.settings.layout||s.is_current())&&(i.console_log("debug:models",'\nChecking current "'+s.get_title()+'" selections:'),l?i.console_log("debug:models","\nProduct selection invalid.\n\n"):p?(i.console_log("debug:models","\nVariation selection invalid - resetting...\n\n"),i.debug_tab_count=i.debug_tab_count+2,s.component_selection_view.resetting_variation=!0,s.$component_summary_content.find(".reset_variations").trigger("click"),s.component_selection_view.resetting_variation=!1,s.component_options_view.render(),i.debug_tab_count=i.debug_tab_count-2):i.console_log("debug:models","...looking good!"))}}))(o)},this.Component_Selection_Model=function(n,o){var s=n;return new(e.Model.extend({selected_product:"",selected_variation_data:"",selected_product_image_data:!1,selected_variation_image_data:!1,initialize:function(){var e="";s.component_options_model.available_options_data.length>0&&t.each(s.component_options_model.available_options_data,function(t,i){if(i.is_selected)return e=i.option_id,!1});var i={selected_product:e,selected_variation:s.find_selected_product_param("variation_id"),selected_quantity:s.find_selected_product_param("quantity"),selected_addons:0,selected_nyp:0};this.selected_product=i.selected_product,this.selected_product_image_data=s.find_selected_product_param("product_image_data"),this.selected_variation_image_data=s.find_selected_product_param("variation_image_data"),this.set(i)},request_details:function(e){var n=this,o=s.component_options_model,a=o.available_options_data,_="";if(t.each(a,function(t,i){if(parseInt(e)===parseInt(i.option_id)&&i.option_details_html)return _=i.option_details_html,!1}),_)n.selected_product=e,n.trigger("component_selection_details_loaded",{result:"success",markup:_});else{var c={action:"woocommerce_show_composited_product",product_id:e,component_id:s.component_id,composite_id:i.composite_id};t.ajax({type:"POST",url:i.get_ajax_url(c.action),data:c,timeout:15e3,dataType:"json",success:function(i){"success"===i.result&&t.each(a,function(t,n){if(parseInt(e)===parseInt(n.option_id))return o.available_options_data[t].option_details_html=i.markup,!1}),n.selected_product=e,n.trigger("component_selection_details_loaded",i)},error:function(){n.selected_product=s.get_selected_product(!1),n.trigger("component_selection_details_load_error")}})}},update_selected_product:function(){var t="",e=s.find_selected_product_param("variation_id"),n=s.find_selected_product_param("quantity"),o=this.get("selected_product")!==this.selected_product,a=this.get("selected_variation")!==e,_=this.get("selected_quantity")!==n;o&&(this.selected_product_image_data=s.find_selected_product_param("product_image_data"),t='Attribute: "selected_product": #'+(""===this.selected_product?"0":this.selected_product)),a&&(e>0?(this.selected_variation_data=s.find_selected_product_param("variation_data"),this.selected_variation_image_data=s.find_selected_product_param("variation_image_data")):(this.selected_variation_data="",this.selected_variation_image_data=!1),t=t+(""!==t?", ":"")+'Attribute: "selected_variation": #'+(""===e?"0":e)),_&&(t=t+(""!==t?", ":"")+'Attribute: "selected_quantity": '+n),(o||a||_)&&i.console_log("debug:models","\nUpdating 'Component_Selection_Model': \""+s.get_title()+'": '+t),i.debug_tab_count=i.debug_tab_count+2,this.set({selected_product:this.selected_product,selected_variation:e,selected_quantity:n,selected_addons:0,selected_nyp:0}),i.debug_tab_count=i.debug_tab_count-2,this.trigger("selected_product_updated",this)},update_selected_variation:function(){var t=s.find_selected_product_param("variation_id");this.get("selected_variation")!==t&&(t>0?(this.selected_variation_data=s.find_selected_product_param("variation_data"),this.selected_variation_image_data=s.find_selected_product_param("variation_image_data")):(this.selected_variation_data="",this.selected_variation_image_data=!1),i.console_log("debug:models","\nUpdating 'Component_Selection_Model': \""+s.get_title()+'", Attribute: "selected_variation": #'+(""===t?"0":t))),i.debug_tab_count=i.debug_tab_count+2,this.set({selected_variation:t}),i.debug_tab_count=i.debug_tab_count-2,this.trigger("selected_variation_updated",this)},update_selected_quantity:function(){var t=s.find_selected_product_param("quantity");this.get("selected_quantity")!==t&&i.console_log("debug:models","\nUpdating 'Component_Selection_Model': \""+s.get_title()+'", Attribute: "selected_quantity": '+t),i.debug_tab_count=i.debug_tab_count+2,this.set({selected_quantity:t}),i.debug_tab_count=i.debug_tab_count-2},update_selected_addons:function(){var t=s.find_selected_product_param("addons_price");t||(t=0),this.get("selected_addons")!==t&&i.console_log("debug:models","\nUpdating 'Component_Selection_Model': \""+s.get_title()+'", Attribute: "selected_addons_price": '+t),i.debug_tab_count=i.debug_tab_count+2,this.set({selected_addons:t}),i.debug_tab_count=i.debug_tab_count-2},update_nyp:function(){var t=s.find_selected_product_param("nyp_price");this.get("selected_nyp")!==t&&i.console_log("debug:models","\nUpdating 'Component_Selection_Model': \""+s.get_title()+'", Attribute: "nyp_price": '+t),s.$component_data.data("price",t),s.$component_data.data("regular_price",t),i.debug_tab_count=i.debug_tab_count+2,this.set({selected_nyp:t}),i.debug_tab_count=i.debug_tab_count-2}}))(o)}},n.WC_CP_Views=function(i){this.Composite_Viewport_Scroller=function(t){return new(e.View.extend({initialize:function(){"single"===i.settings.layout?i.actions.add_action("show_step",this.autoscroll_single,10,this):"paged"===i.settings.layout?(i.actions.add_action("active_step_changed",this.autoscroll_paged,120,this),i.actions.add_action("active_step_transition_end",this.autoscroll_paged_relocated,10,this)):"progressive"===i.settings.layout&&i.actions.add_action("active_step_transition_end",this.autoscroll_progressive,10,this),i.actions.add_action("component_options_update_requested",this.component_options_update_requested,10,this),i.actions.add_action("component_selection_details_updated",this.selection_details_updated,10,this),i.actions.add_action("component_selection_details_animated",this.selection_details_animated,10,this),i.actions.add_action("component_selection_details_relocation_ended",this.selection_details_relocation_ended,10,this)},component_options_update_requested:function(t,e,n,o){"reload"===n&&!1===o&&i.composite_viewport_scroller.scroll_viewport(t.$component_pagination.filter(".top"),{offset:50,partial:!0,duration:200,queue:!1})},selection_details_relocation_ended:function(t){t.component_selection_view.flushing_component_options&&setTimeout(function(){t.$component_content.slideDown(250),i.composite_viewport_scroller.scroll_viewport("relative",{offset:-t.$component_summary.outerHeight(!0),timeout:0,duration:250,queue:!1})},200)},selection_details_updated:function(t){this.autoscroll_selection_details(t,"updated")},selection_details_animated:function(t){this.autoscroll_selection_details(t,"animated")},autoscroll_selection_details:function(t,e){var n=t.component_selection_view,o=!0,s=t.$component_content_scroll_target;if(""!==n.model.selected_product){if(n.is_relocated()){if("animated"!==e)return;s=n.$relocation_target,o=!1}else if("animated"===e)return;i.is_initialized&&i.composite_viewport_scroller.scroll_viewport(s,{timeout:50,partial:o,scroll_method:"quarter",duration:250,queue:!1})}},autoscroll_single:function(t){i.is_initialized&&i.composite_viewport_scroller.scroll_viewport(t.$el,{partial:!1,duration:250,queue:!1})},autoscroll_paged:function(t){var e=i.is_initialized,n=t.is_component(),o=!!n&&t;n&&o.component_selection_view.is_relocated()||e&&i.composite_viewport_scroller.scroll_viewport(i.$composite_transition_helper,{timeout:20,partial:!1,duration:250,queue:!1})},autoscroll_paged_relocated:function(t){var e=i.is_initialized,n=t.is_component(),o=!!n&&t;n&&o.component_selection_view.is_relocated()&&e&&i.composite_viewport_scroller.scroll_viewport(o.$component_content,{timeout:0,partial:!1,duration:250,queue:!1,scroll_method:"middle"})},autoscroll_progressive:function(t){i.is_initialized&&t.$el.hasClass("autoscrolled")&&(t.$step_title.wc_cp_is_in_viewport(!1)||i.composite_viewport_scroller.scroll_viewport(t.$el,{timeout:0,partial:!1,duration:250,queue:!1}))},scroll_viewport:function(t,e){var i,n,o=void 0===e.partial||e.partial,s=void 0===e.offset?50:e.offset,a=void 0===e.timeout?5:e.timeout,_=void 0===e.duration?250:e.duration,c=void 0!==e.queue&&e.queue,d=void 0!==e.always_on_complete&&e.always_on_complete,r=void 0!==e.scroll_method&&e.scroll_method,l=!1,p=$wc_cp_window,u=$wc_cp_document;i=void 0===e.on_complete||!1===e.on_complete?function(){return!1}:e.on_complete;var m=function(){if("relative"===t)n=p.scrollTop()-s,l=!0;else if("absolute"===t)n=s,l=!0;else if(t.length>0&&t.is(":visible")&&!1===t.wc_cp_is_in_viewport(o)){var e=s;e="bottom"===r||t.hasClass("scroll_bottom")?p.height()-t.outerHeight(!0)-s:"middle"===r?p.height()/3*2-t.outerHeight(!0)-s:"quarter"===r?p.height()/4+s:parseInt(wc_composite_params.scroll_viewport_top_offset)+s,n=t.offset().top-e,t.offset().top<n&&(n=t.offset().top),l=!0}if(l){n>u.height()-p.height()&&(n=u.height()-p.height()-100);var a=$wc_cp_html.scrollTop(),m=$wc_cp_body;$wc_cp_html.scrollTop($wc_cp_html.scrollTop()-1),a!=$wc_cp_html.scrollTop()&&(m=$wc_cp_html),m.animate({scrollTop:n},{duration:_,queue:c,always:i})}else d&&i()};a>0?setTimeout(function(){m()},a):m()},illusion_scroll:function(t){if(void 0===t||void 0===t.target||!t.target)return null;var e=t.target,i=$wc_cp_window.scrollTop(),n=void 0!==t.type?t.type:"hide",o=!0,s=0,a=0;if("hide"===n){if("none"===e.css("display"))return null}else if("none"!==e.css("display"))return null;return"hide"!==n&&e.css({height:"0",display:"block"}),(o=e.offset().top<i&&!1===e.wc_cp_is_in_viewport(!0))&&("hide"!==n&&e.css({height:"",position:"absolute"}),o=(a=void 0!==e.get(0).getBoundingClientRect().height?e.get(0).getBoundingClientRect().height:e.outerHeight())>=1),"hide"!==n&&e.css({height:"",position:"",display:"none"}),o&&(s="hide"===n?i-Math.round(a):i+Math.round(a),setTimeout(function(){window.scroll(0,s),"hide"===n?e.hide():e.show()},10)),o}}))(t)},this.Composite_Status_View=function(t){return new(e.View.extend({is_active:!1,template:!1,worker:!1,$el_content:!1,initialize:function(t){var e=this;this.template=wp.template("wc_cp_composite_status"),this.$el_content=t.$el_content,this.listenTo(this.model,"change:status_messages",this.status_changed);this.worker=new function(){var t=this;this.timer=!1,this.tasks=[],this.last_added_task=[],this.is_idle=function(){return!1===this.timer},this.work=function(){if(t.tasks.length>0){var i=t.tasks.shift();e.render(i),t.timer=setTimeout(function(){t.work()},400)}else clearTimeout(t.timer),t.timer=!1},this.add_task=function(t){var e=[];e=_.pluck(_.where(this.last_added_task,{is_old:!1}),"message_content").length<t.length?_.map(t,function(t){return{message_content:t,is_old:!1}}):_.map(_.where(this.last_added_task,{is_old:!1}),function(e){return{message_content:e.message_content,is_old:!1===_.contains(t,e.message_content)}}),this.last_added_task=e,this.tasks.push(e),_.where(e,{is_old:!0}).length===e.length&&this.tasks.push([])}}},render:function(t){var e=this;0===t.length?(i.console_log("debug:views","\nHiding composite status view..."),this.$el.removeClass("visible"),setTimeout(function(){e.$el.removeClass("active")},200),this.is_active=!1):(i.console_log("debug:views","\nUpdating composite status view..."),this.$el_content.html(this.template(t)),!1===this.is_active?(this.$el.addClass("active"),setTimeout(function(){e.$el.addClass("visible")},5),this.is_active=!0):setTimeout(function(){e.$el.find(".message:not(.current)").addClass("old")},100))},status_changed:function(){var t=this.model.get("status_messages");t.length>0?this.worker.add_task(_.pluck(t,"message_content")):this.worker.add_task([]),this.worker.is_idle()&&this.worker.work()}}))(t)},this.Composite_Validation_View=function(t){return new(e.View.extend({render_timer:!1,is_in_widget:!1,template:!1,initialize:function(t){this.template=wp.template("wc_cp_validation_message"),this.is_in_widget=t.is_in_widget,i.actions.add_action("composite_validation_message_changed",this.render,100,this)},render:function(){var t=this,e=this.model;i.console_log("debug:views","\nScheduled update of composite validation view"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"."),clearTimeout(t.render_timer),t.render_timer=setTimeout(function(){t.render_task(e)},10)},render_task:function(t){i.console_log("debug:views","\nUpdating composite validation view"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"...");var e=t.get("validation_messages");!1===t.get("passes_validation")&&e.length>0?(this.$el.html(this.template(e)),this.$el.removeClass("inactive").slideDown(200)):this.$el.addClass("inactive").slideUp(200)}}))(t)},this.Composite_Price_View=function(n){return new(e.View.extend({render_timer:!1,is_in_widget:!1,suffix:"",suffix_contains_price_incl:!1,suffix_contains_price_excl:!1,$addons_totals:!1,show_addons_totals:!1,initialize:function(t){this.is_in_widget=t.is_in_widget,this.is_in_widget||(this.$addons_totals=i.$composite_data.find("#product-addons-total"),this.has_addons()?1==this.$addons_totals.data("show-sub-total")&&(this.$addons_totals.data("show-sub-total",0),this.$el.after(this.$addons_totals),this.show_addons_totals=!0,i.actions.add_action("composite_totals_changed",this.update_addons_totals,100,this),i.$composite_data.on("updated_addons",{view:this},this.updated_addons_handler)):this.$addons_totals=!1),""!==wc_composite_params.price_display_suffix&&(this.suffix=' <small class="woocommerce-price-suffix">'+wc_composite_params.price_display_suffix+"</small>",this.suffix_contains_price_incl=wc_composite_params.price_display_suffix.indexOf("{price_including_tax}")>-1,this.suffix_contains_price_excl=wc_composite_params.price_display_suffix.indexOf("{price_excluding_tax}")>-1),i.actions.add_action("composite_totals_changed",this.render,100,this),i.actions.add_action("composite_validation_message_changed",this.render,100,this)},has_addons:function(){return this.$addons_totals&&this.$addons_totals.length>0},updated_addons_handler:function(t){t.data.view.update_addons_totals(),t.stopPropagation()},update_addons_totals:function(){var e=this.model;if(this.show_addons_totals)if(e.get("passes_validation")){var i=t.extend(!0,{},e.price_data),n=e.get_quantity(),o=Number(i.base_price_tax),s=this.$addons_totals.data("addons-raw-price");if(s>0){var a=e.get_taxed_totals(s,s,o,n),_="",c="",d="";i.base_price=Number(i.base_price)+Number(s),(i=e.calculate_subtotals(!1,i,n)).totals=e.calculate_totals(i),_=wc_cp_price_format(i.totals.price),c=this.get_formatted_price_suffix(i.totals),d='<dl class="product-addon-totals"><dt>'+woocommerce_addons_params.i18n_addon_total+'</dt><dd><strong><span class="amount">'+wc_cp_price_format(a.price)+"</span></strong></dd>",d+="<dt>"+wc_composite_params.i18n_addons_total_string+"</dt><dd><strong>"+_+c+"</strong></dd></dl>",this.$addons_totals.html(d)}else this.$addons_totals.empty()}else this.$addons_totals.empty()},get_price_html:function(t){var e=this.model,n=void 0===t?e.price_data:t,o=void 0===t?e.get("totals"):t.totals,s=wc_composite_params.i18n_total?'<span class="total">'+wc_composite_params.i18n_total+"</span>":"",a="";if(0===o.price&&"yes"===n.show_free_string)a=wc_composite_params.i18n_price_format.replace("%t",s).replace("%p",wc_composite_params.i18n_free).replace("%s","");else{var _=wc_cp_price_format(o.price),c=wc_cp_price_format(o.regular_price),d=this.get_formatted_price_suffix(o);o.regular_price>o.price&&(_=wc_composite_params.i18n_strikeout_price_string.replace("%f",c).replace("%t",_)),a=wc_composite_params.i18n_price_format.replace("%t",s).replace("%p",_).replace("%s",d)}return a='<p class="price">'+a+"</p>",i.filters.apply_filters("composite_price_html",[a,this,t])},get_formatted_price_suffix:function(t){var e=this.model,i=this.suffix;return t=void 0===t?e.get("totals"):t,""!==i&&(this.suffix_contains_price_incl&&(i=i.replace("{price_including_tax}",wc_cp_price_format(t.price_incl_tax))),this.suffix_contains_price_excl&&(i=i.replace("{price_excluding_tax}",wc_cp_price_format(t.price_excl_tax)))),i},render:function(){var t=this,e=this.model;i.console_log("debug:views","\nScheduled update of composite price view"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"."),clearTimeout(t.render_timer),t.render_timer=setTimeout(function(){t.render_task(e)},10)},render_task:function(t){var e;i.console_log("debug:views","\nUpdating composite price view"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"..."),!t.get("passes_validation")||t.price_data.total===t.price_data.base_display_price&&"yes"!==t.price_data.has_price_range?this.$el.addClass("inactive").slideUp(200):(e=this.get_price_html(),this.$el.html(e),this.$el.removeClass("inactive").slideDown(200))}}))(n)},this.Composite_Availability_View=function(n){return new(e.View.extend({$composite_stock_status:!1,is_in_widget:!1,render_timer:!1,initialize:function(t){this.is_in_widget=t.is_in_widget,i.$composite_data.find(".composite_wrap p.stock").length>0&&(this.$composite_stock_status=i.$composite_data.find(".composite_wrap p.stock").clone()),i.actions.add_action("composite_availability_message_changed",this.render,100,this)},render:function(){var t=this,e=this.model;i.console_log("debug:views","\nScheduled update of composite availability view"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"."),clearTimeout(t.render_timer),t.render_timer=setTimeout(function(){t.render_task(e)},10)},render_task:function(t){i.console_log("debug:views","\nUpdating composite availability view"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"...");var e=this.get_insufficient_stock_components();if(e.length>0){var n=wc_composite_params.i18n_insufficient_stock.replace("%s",wc_cp_join(_.map(e,function(t){return i.api.get_step_title(t)})));this.$el.html(n).slideDown(200)}else!1!==this.$composite_stock_status?this.$el.html(this.$composite_stock_status).slideDown(200):this.$el.slideUp(200)},get_insufficient_stock_components:function(){var e=[];return t.each(i.get_components(),function(t,i){i.step_validation_model.get("is_in_stock")||e.push(i.component_id)}),e}}))(n)},this.Composite_Add_To_Cart_Button_View=function(n){return new(e.View.extend({render_timer:!1,is_in_widget:!1,$el_button:!1,$el_qty:!1,widget_qty_synced:!1,initialize:function(e){var n=this.model;this.is_in_widget=e.is_in_widget,this.$el_button=e.$el_button,this.$el_qty=this.$el.find(".quantity input.qty"),i.actions.add_action("composite_availability_status_changed",this.render,100,this),i.actions.add_action("composite_validation_status_changed",this.render,100,this),this.is_in_widget||this.$el_button.on("click",function(e){n.get("passes_validation")&&n.get("is_in_stock")?t.each(i.get_steps(),function(e,i){i.$el.find("select, input").each(function(){t(this).prop("disabled",!1)}),!1===i.step_visibility_model.get("is_visible")&&i.is_component()&&i.$component_summary_content.append('<input name="wccp_component_selection_nil['+i.step_id+']" value="1"/>')}):(e.preventDefault(),window.alert(wc_composite_params.i18n_validation_issues))}),this.is_in_widget&&(this.$el_button.on("click",function(){i.composite_add_to_cart_button_view.$el_button.trigger("click")}),this.$el_qty.length>0&&(this.$el_qty.on("change",{view:this},function(t){var e=t.data.view;e.widget_qty_synced||(i.console_log("debug:views","\nCopying widget #"+e.is_in_widget+" quantity value into composite add-to-cart quantity field..."),e.widget_qty_synced=!0,i.composite_add_to_cart_button_view.$el_qty.val(e.$el_qty.val()).change(),e.widget_qty_synced=!1)}),i.composite_add_to_cart_button_view.$el_qty.on("change",{view:this},function(t){var e=t.data.view;i.console_log("debug:views","\nCopying composite add-to-cart quantity value into widget #"+e.is_in_widget+" quantity field..."),e.$el_qty.val(i.composite_add_to_cart_button_view.$el_qty.val()).change()})))},render:function(){var t=this,e=this.model;i.console_log("debug:views","\nScheduled update of composite add-to-cart button view"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"."),clearTimeout(t.render_timer),t.render_timer=setTimeout(function(){t.render_task(e)},10)},render_task:function(t){i.console_log("debug:views","\nUpdating composite add-to-cart button view"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"..."),t.get("passes_validation")&&t.get("is_in_stock")?"new"===i.settings.button_behaviour?this.$el_button.removeClass("disabled"):this.$el.slideDown(200):"new"===i.settings.button_behaviour?this.$el_button.addClass("disabled"):this.$el.slideUp(200)}}))(n)},this.Composite_Pagination_View=function(n){return new(e.View.extend({template:!1,template_html:"",initialize:function(){this.template=wp.template("wc_cp_composite_pagination"),i.actions.add_action("step_access_changed",this.step_access_changed_handler,100,this),i.actions.add_action("step_visibility_changed",this.step_visibility_changed_handler,100,this),i.actions.add_action("active_step_changed",this.active_step_changed_handler,100,this),this.$el.on("click",".pagination_element a",this.clicked_pagination_element)},step_visibility_changed_handler:function(){this.render()},step_access_changed_handler:function(){this.render()},active_step_changed_handler:function(){this.render()},clicked_pagination_element:function(){if(t(this).blur(),i.has_transition_lock)return!1;if(t(this).hasClass("inactive"))return!1;var e=t(this).closest(".pagination_element").data("item_id"),n=i.get_step(e);return n&&i.navigate_to_step(n),!1},render:function(){var e=[];if(!i.is_initialized)return!1;i.console_log("debug:views","\nRendering pagination view elements..."),t.each(i.get_steps(),function(t,i){if(i.is_visible()){var n={element_id:i.step_id,element_title:i.get_title(),element_class:"",element_state_class:""};i.is_current()?(n.element_state_class="inactive",n.element_class="pagination_element_current"):i.is_locked()&&(n.element_state_class="inactive"),e.push(n)}}),e=i.filters.apply_filters("composite_pagination_view_data",[e]);var n=this.template(e);n!==this.template_html?(this.template_html=n,this.$el.html(n)):i.console_log("debug:views","...skipped!")}}))(n)},this.Composite_Summary_View=function(n){return new(e.View.extend({update_content_timers:{},view_elements:{},is_in_widget:!1,template:!1,initialize:function(e){var n=this;this.template=wp.template("wc_cp_summary_element_content"),this.is_in_widget=e.is_in_widget,t.each(i.get_steps(),function(t,e){e.step_validation_model.on("change:passes_validation",function(){n.render_element_content(e)})}),t.each(i.get_components(),function(t,e){n.view_elements[e.component_id]={$summary_element:n.$el.find(".summary_element_"+e.component_id),$summary_element_link:n.$el.find(".summary_element_"+e.component_id+" .summary_element_link"),$summary_element_wrapper:n.$el.find(".summary_element_"+e.component_id+" .summary_element_wrapper"),$summary_element_inner:n.$el.find(".summary_element_"+e.component_id+" .summary_element_wrapper_inner"),template_html:""}}),i.actions.add_action("step_access_changed",this.step_access_changed_handler,100,this),i.actions.add_action("step_visibility_changed",this.step_visibility_changed_handler,100,this),i.actions.add_action("component_quantity_changed",this.quantity_changed_handler,100,this),i.actions.add_action("component_selection_changed",this.selection_changed_handler,100,this),i.actions.add_action("component_selection_content_changed",this.selection_changed_handler,100,this),i.actions.add_action("component_totals_changed",this.component_totals_changed_handler,100,this),"single"!==i.settings.layout&&i.actions.add_action("active_step_changed",this.active_step_changed_handler,100,this),this.$el.on("click",".summary_element_link",this.clicked_summary_element),this.$el.on("click","a.summary_element_tap",function(){return t(this).closest(".summary_element_link").trigger("click"),!1})},step_access_changed_handler:function(t){this.render_element_state(t)},step_visibility_changed_handler:function(t){this.render_element_visibility(t),this.render_indexes(t.step_index)},active_step_changed_handler:function(){this.render_state()},selection_changed_handler:function(t){this.render_element_content(t)},quantity_changed_handler:function(t){this.render_element_content(t)},component_totals_changed_handler:function(t){this.render_element_content(t)},clicked_summary_element:function(){if(i.has_transition_lock)return!1;if(t(this).hasClass("disabled"))return!1;var e=t(this).closest(".summary_element").data("item_id"),n=i.get_step(e);return!1!==n&&(n.is_current()&&"single"!==i.settings.layout||i.navigate_to_step(n),!1)},render_indexes:function(e){if(!i.is_initialized)return!1;e=void 0===e?0:e;var n=parseInt(i.$composite_summary.data("columns")),o=0,s=this;i.console_log("debug:views","\nUpdating summary view element indexes..."),t.each(i.get_steps(),function(t,a){if(void 0===s.view_elements[a.step_id])return!0;if(a.step_index<e)return a.is_visible()&&o++,!0;if(!1===s.is_in_widget){var _="";a.is_visible()&&((++o-1)%n!=0&&1!=n||(_+=" first"),o%n==0&&(_+=" last")),s.view_elements[a.step_id].$summary_element.removeClass("first last").addClass(_)}i.debug_tab_count=i.debug_tab_count+2,s.render_element_content(a),i.debug_tab_count=i.debug_tab_count-2})},render_visibility:function(){if(!i.is_initialized)return!1;var e=this;i.console_log("debug:views","\nRendering summary view element visibility"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"..."),i.debug_tab_count=i.debug_tab_count+2,t.each(i.get_steps(),function(t,i){e.render_element_visibility(i)}),i.debug_tab_count=i.debug_tab_count-2},render_state:function(){if(!i.is_initialized)return!1;var e=this;i.console_log("debug:views","\nRendering summary view element states"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"..."),i.debug_tab_count=i.debug_tab_count+2,t.each(i.get_steps(),function(t,i){e.render_element_state(i)}),i.debug_tab_count=i.debug_tab_count-2},render_content:function(){var e=this;i.console_log("debug:views","\nRendering summary view element contents"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"..."),i.debug_tab_count=i.debug_tab_count+2,t.each(i.get_steps(),function(t,i){e.render_element_content(i)}),i.debug_tab_count=i.debug_tab_count-2},render:function(){i.console_log("debug:views","\nRendering summary view elements"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"..."),i.debug_tab_count=i.debug_tab_count+2,this.render_visibility(),this.render_state(),this.render_indexes(),this.render_content(),i.debug_tab_count=i.debug_tab_count-2},get_element_price_html:function(t){var e=i.data_model.price_data,n="";if(t.is_component()&&t.is_subtotal_visible()&&t.passes_validation()){var o=t,s=o.component_id,a="variable"===o.get_selected_product_type()?o.get_selected_variation(!1):o.get_selected_product(!1),_=o.get_selected_quantity();if(a>0&&_>0){var c=i.data_model.get("component_"+s+"_totals");if("no"===e.is_priced_individually[s]&&0===c.price&&0===c.regular_price)n="";else{var d=wc_cp_price_format(c.price),r=wc_cp_price_format(c.regular_price);c.regular_price>c.price&&(d=wc_composite_params.i18n_strikeout_price_string.replace("%f",r).replace("%t",d)),n='<span class="price summary_element_content">'+d+"</span>"}}}return n},render_element_content:function(t){if(!i.is_initialized)return!1;var e=this;if(void 0===this.view_elements[t.step_id])return!1;i.console_log("debug:views",'\nScheduled update of "'+t.get_title()+'" summary view element content'+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"."),void 0!==this.update_content_timers[t.step_index]&&clearTimeout(e.update_content_timers[t.step_index]),this.update_content_timers[t.step_index]=setTimeout(function(){e.render_element_content_task(t)},50)},render_element_content_task:function(t){if(i.console_log("debug:views",'\nRendering "'+t.get_title()+'" summary view element content'+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"..."),t.is_component()){var e=t,n=e.component_id,o=this.view_elements[n].$summary_element_wrapper,s=this.view_elements[n].$summary_element_inner,a=this.view_elements[n].template_html,_={element_index:t.get_title_index(),element_title:t.get_title(),element_selection_title:"",element_action:"",element_image_src:"",element_image_srcset:"",element_image_sizes:"",element_image_title:"",element_price:""},c="",d="",r=!1,l=0,p=this.$el.is(":visible");p&&(l=s.outerHeight(!0),o.css("height",l)),c=e.get_selected_product_title(!0,!1),!1===this.is_in_widget&&(d=c&&e.passes_validation()?e.is_static()?wc_composite_params.i18n_summary_static_component:wc_composite_params.i18n_summary_configured_component:wc_composite_params.i18n_summary_empty_component),(t.is_current()&&p||this.is_in_widget)&&(d=""),_.element_selection_title=c,_.element_action=d,!1===(r=e.get_selected_product_image_data(!1))&&(r=e.get_placeholder_image_data()),r&&(_.element_image_src=r.image_src,_.element_image_srcset=r.image_srcset?r.image_srcset:"",_.element_image_sizes=r.image_sizes?r.image_sizes:"",_.element_image_title=r.image_title),_.element_price=this.get_element_price_html(t),_=i.filters.apply_filters("component_summary_element_content_data",[_,e,this]);var u=this.template(_);u!==a?(this.view_elements[n].template_html=u,s.html(u)):i.console_log("debug:views","...skipped!"),e.passes_validation()?o.addClass("configured"):o.removeClass("configured"),i.actions.do_action("component_summary_content_updated",[e,this]);var m=0,h=function(){r.image_src&&0===s.find(".summary_element_image img").height()&&m<1e3?(m+=50,setTimeout(function(){h()},50)):g()},g=function(){var t=s.outerHeight(!0),e=!1;Math.abs(t-l)>1?e=!0:o.css("height","auto"),e&&(i.console_log("debug:events","Starting updated element content animation..."),o.animate({height:t},{duration:200,queue:!1,always:function(){i.console_log("debug:events","Ended updated element content animation."),o.css({height:"auto"})}}))};p&&setTimeout(function(){h()},10)}},render_element_visibility:function(t){if(!i.is_initialized)return!1;if(void 0===this.view_elements[t.step_id])return!1;var e=this.view_elements[t.step_id].$summary_element;i.console_log("debug:views",'\nUpdating "'+t.get_title()+'" summary view element visibility'+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"..."),!1===t.is_visible()?e.addClass("hidden"):e.removeClass("hidden")},render_element_state:function(t){if(!i.is_initialized)return!1;if(void 0===this.view_elements[t.step_id])return!1;var e=this.view_elements[t.step_id].$summary_element,n=this.view_elements[t.step_id].$summary_element_link;i.console_log("debug:views",'\nUpdating "'+t.get_title()+'" summary view element state'+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"..."),t.is_current()?(n.removeClass("disabled"),"single"!==i.settings.layout&&n.addClass("selected"),!1===i.get_step("review")&&e.find(".summary_element_selection_prompt").slideUp(200)):(t.is_locked()?(n.removeClass("selected"),n.addClass("disabled")):(n.removeClass("disabled"),n.removeClass("selected")),e.find(".summary_element_selection_prompt").slideDown(200))}}))(n)},this.Composite_Navigation_View=function(n){return new(e.View.extend({render_timer:!1,render_movable_timer:!1,updated_buttons_data:{},navi_in_step:!1,template:!1,$el_progressive:i.$composite_form.find(".composite_navigation.progressive"),$el_paged_top:i.$composite_navigation_top,$el_paged_bottom:i.$composite_navigation_bottom,$el_paged_movable:i.$composite_navigation_movable,initialize:function(){this.template=wp.template("wc_cp_composite_navigation"),i.actions.add_action("component_selection_changed",this.selection_changed_handler,110,this),i.actions.add_action("component_selection_content_changed",this.selection_content_changed_handler,100,this),i.actions.add_action("active_step_transition_start",this.active_step_transition_start_handler,110,this),i.actions.add_action("component_options_state_rendered",this.options_state_rendered_handler,20,this),this.$el.on("click",".page_button",this.clicked_navigation_button)},selection_content_changed_handler:function(){if(!i.is_initialized)return!1;this.render_change()},selection_changed_handler:function(t){if(!i.is_initialized)return!1;if(t.is_current()&&t.autotransition()&&t.passes_validation()&&t.get_selected_product()>0){var e=i.get_next_step();return e&&e.is_component()&&e.component_options_view.is_updating()?i.actions.add_action("component_options_refreshed_"+e.step_id,this.autotransition,10,this):i.show_next_step(),!1}this.render_change()},autotransition:function(){i.show_next_step(),i.actions.remove_action("component_options_refreshed_"+i.get_current_step().step_id,this.autotransition)},active_step_transition_start_handler:function(){var t=this;clearTimeout(t.render_timer),t.render("transition")},options_state_rendered_handler:function(t,e){if(!i.is_initialized)return!1;t.is_current()&&_.contains(e,"thumbnails")&&t.component_selection_view.is_relocated()&&this.render_movable()},clicked_navigation_button:function(){return t(this).blur(),!t(this).hasClass("inactive")&&(!i.has_transition_lock&&(t(this).hasClass("next")?i.get_next_step()?i.show_next_step():i.composite_viewport_scroller.scroll_viewport(i.$composite_form.find(".scroll_final_step"),{partial:!1,duration:250,queue:!1}):i.show_previous_step(),!1))},update_buttons:function(){var t=this,e={prev_btn:{btn_classes:"",btn_text:""},next_btn:{btn_classes:"",btn_text:""}};!1!==this.updated_buttons_data.button_next_html&&(e.next_btn.btn_text=this.updated_buttons_data.button_next_html),!1!==this.updated_buttons_data.button_prev_html&&(e.prev_btn.btn_text=this.updated_buttons_data.button_prev_html),!1===this.updated_buttons_data.button_next_visible&&(e.next_btn.btn_classes="invisible"),!1===this.updated_buttons_data.button_prev_visible&&(e.prev_btn.btn_classes="invisible"),!1===this.updated_buttons_data.button_next_active&&(e.next_btn.btn_classes+=" inactive"),this.$el.html(t.template(e))},render_change:function(){var t=this;i.console_log("debug:views","\nScheduling navigation UI update..."),clearTimeout(t.render_timer),t.render_timer=setTimeout(function(){t.render("change")},40)},render:function(t){i.console_log("debug:views","\nRendering navigation UI...");var e=i.get_current_step(),n=i.get_next_step(),o=i.get_previous_step(),s=this;if(this.updated_buttons_data={button_next_html:!1,button_prev_html:!1,button_next_visible:!1,button_prev_visible:!1,button_next_active:!1},"transition"===t&&"paged"===i.settings.layout&&"componentized"===i.settings.layout_variation&&(e.is_review()?this.$el_paged_bottom.hide():this.$el_paged_bottom.show()),e.is_component()&&(n&&"componentized"!==i.settings.layout_variation?(this.updated_buttons_data.button_next_html=wc_composite_params.i18n_next_step.replace("%s",n.get_title()),this.updated_buttons_data.button_next_visible=!0):n&&"paged"===i.settings.layout&&(this.updated_buttons_data.button_next_html=wc_composite_params.i18n_final_step,this.updated_buttons_data.button_next_visible=!0)),e.passes_validation()||"componentized"===i.settings.layout_variation&&e.is_component())n&&(this.updated_buttons_data.button_next_active=!0),o&&"paged"===i.settings.layout&&o.is_component()?(this.updated_buttons_data.button_prev_html=wc_composite_params.i18n_previous_step.replace("%s",o.get_title()),this.updated_buttons_data.button_prev_visible=!0):this.updated_buttons_data.button_prev_html="";else if(o&&o.is_component()){var a=o.get_selected_product();(a>0||"0"===a||""===a&&o.is_optional())&&"paged"===i.settings.layout&&(this.updated_buttons_data.button_prev_html=wc_composite_params.i18n_previous_step.replace("%s",o.get_title()),this.updated_buttons_data.button_prev_visible=!0)}if("progressive"===i.settings.layout){var _=s.$el_progressive;if(s.navi_in_step!==e.step_id)_.slideUp({duration:200,always:function(){s.update_buttons(),_.appendTo(e.$inner_el).hide(),s.navi_in_step=e.step_id,setTimeout(function(){var t=!1;e.$el.hasClass("last")||e.passes_validation()&&!n.has_toggle()&&(t=!0),t&&_.slideDown({duration:200,queue:!1})},200)}});else{s.update_buttons();var c=!1;e.$el.hasClass("last")||e.passes_validation()&&!n.has_toggle()&&(c=!0),c?_.slideDown(200):_.slideUp(200)}}else"paged"===i.settings.layout&&(s.navi_in_step!==e.step_id&&(e.$el.prepend(s.$el_paged_top),e.$el.append(s.$el_paged_bottom),s.navi_in_step=e.step_id),s.update_buttons(),s.render_movable())},render_movable:function(){var t=this;i.console_log("debug:views","\nScheduling movable navigation visibility update..."),clearTimeout(t.render_movable_timer),t.render_movable_timer=setTimeout(function(){t.render_movable_task()},10)},render_movable_task:function(){var t=i.get_current_step(),e=this;if(t.is_component()&&t.has_options_style("thumbnails")&&t.get_selected_product()>0){var n=t.$component_content.find(".composite_navigation").length>0,o=!1;if(t.append_results()&&t.component_selection_view.is_relocated()){var s=t.$component_options.find(".component_option_thumbnail_container").not(".hidden"),a=t.$component_options.find(".component_option_thumbnail.selected").closest(".component_option_thumbnail_container"),_=s.index(a)+1,c=i.$composite_form.width()>wc_composite_params.small_width_threshold&&!1===i.$composite_form.hasClass("legacy_width")?parseInt(t.$component_thumbnail_options.data("columns")):1;Math.ceil(_/c)===Math.ceil(s.length/c)&&(o=!0)}n||o||(e.$el_paged_movable.appendTo(t.$component_summary),n=!0),n&&(o||t.is_static()?e.$el_paged_movable.addClass("hidden"):e.$el_paged_movable.removeClass("hidden"))}}}))(n)},this.Composite_Widget_View=function(t){return new(e.View.extend({show_hide_timer:!1,initialize:function(t){this.$el.removeClass("cp-no-js"),this.validation_view=new i.view_classes.Composite_Validation_View({is_in_widget:t.widget_count,el:this.$el.find(".widget_composite_summary_error .composite_message"),model:i.data_model}),this.price_view=new i.view_classes.Composite_Price_View({is_in_widget:t.widget_count,el:this.$el.find(".widget_composite_summary_price .composite_price"),model:i.data_model}),this.availability_view=new i.view_classes.Composite_Availability_View({is_in_widget:t.widget_count,el:this.$el.find(".widget_composite_summary_availability .composite_availability"),model:i.data_model}),this.add_to_cart_button_view=new i.view_classes.Composite_Add_To_Cart_Button_View({is_in_widget:t.widget_count,el:this.$el.find(".widget_composite_summary_button .composite_button"),$el_button:this.$el.find(".widget_composite_summary_button .composite_button .composite_add_to_cart_button"),model:i.data_model}),this.composite_summary_view=new i.view_classes.Composite_Summary_View({is_in_widget:t.widget_count,el:this.$el.find(".widget_composite_summary_elements")}),i.actions.do_action("widget_view_initialized",[t,this]),"paged"===i.settings.layout&&i.actions.add_action("active_step_changed",this.active_step_changed_handler,100,this)},active_step_changed_handler:function(){this.show_hide()},show_hide:function(){var t=this;clearTimeout(t.show_hide_timer),this.show_hide_timer=setTimeout(function(){t.show_hide_task()},20)},show_hide_task:function(){var t=i.get_current_step().is_review(),e=void 0!==i.settings.show_widget_in_review_step&&"yes"===i.settings.show_widget_in_review_step?"yes":"no";t&&"no"===e?(this.$el.slideUp(250),this.$el.animate({opacity:0},{duration:250,queue:!1}),this.$el.addClass("inactive")):this.$el.hasClass("inactive")&&(this.$el.removeClass("inactive"),this.$el.slideDown(250),this.$el.animate({opacity:1},{duration:250,queue:!1}))}}))(t)},this.Step_Validation_View=function(n,o){var s=n;return new(e.View.extend({render_timer:!1,render_html:!1,template:!1,event_type:"",initialize:function(){var t=this;this.template=wp.template("wc_cp_validation_message"),this.listenTo(this.model,"change:component_messages",function(){if(!s.is_current()||void 0===s.$component_message)return!1;i.console_log("debug:views",'\nScheduling "'+s.get_title()+'" validation message update...'),clearTimeout(t.render_timer),t.render_timer=setTimeout(function(){t.prepare_render("change"),t.render()},10)}),"single"!==i.settings.layout&&i.actions.add_action("active_step_changed_"+s.step_id,this.active_step_changed_handler,100,this),"single"!==i.settings.layout&&i.actions.add_action("active_step_transition_end_"+s.step_id,this.active_step_transition_end_handler,100,this),i.actions.add_action("component_selection_details_relocation_started",this.relocation_started_handler,100,this),i.actions.add_action("component_selection_details_relocation_ended",this.relocation_ended_handler,100,this),i.actions.add_action("component_selection_details_relocation_container_created",this.relocation_container_created_handler,100,this)},relocation_started_handler:function(t){if(t.step_id===s.step_id){var e=s.$component_message.filter(".top");i.console_log("debug:views",'\nHiding "'+s.get_title()+'" validation message to prepare for component details relocation...'),e&&!1===i.composite_viewport_scroller.illusion_scroll({target:e,type:"hide"})&&e.slideUp(200)}},relocation_container_created_handler:function(t){if(t.step_id===s.step_id){i.console_log("debug:views",'\nMoving "'+s.get_title()+'" validation message into relocation target...');var e=s.$component_message.filter(".top");e&&s.component_selection_view.$relocation_target.prepend(e)}},relocation_ended_handler:function(t){if(t.step_id===s.step_id){var e=s.$component_message.filter(".top");i.console_log("debug:views",'\nMoving "'+s.get_title()+'" validation message back to its original position...'),e&&s.component_selection_view.$relocation_origin.after(e)}},active_step_changed_handler:function(){if(!s.is_current()||void 0===s.$component_message)return!1;this.prepare_render("transition")},active_step_transition_end_handler:function(){if(!s.is_current()||void 0===s.$component_message)return!1;clearTimeout(this.render_timer),this.render()},prepare_render:function(t){this.event_type=""===this.event_type?t:this.event_type;if(i.console_log("debug:views",'\nPreparing "'+s.get_title()+'" validation message update...'),this.render_html=!1,!(s.passes_validation()||"componentized"===i.settings.layout_variation&&s.is_component())&&(!s.$el.hasClass("last")||!s.$el.hasClass("progressive"))){var e=s.get_validation_messages();e.length>0&&(this.render_html=this.template(e))}"transition"===this.event_type&&!1===this.render_html&&("progressive"===i.settings.layout?s.has_toggle()&&s.$component_message.hide():"paged"===i.settings.layout&&s.$component_message.hide())},render:function(){var e=this;i.console_log("debug:views",'\nUpdating "'+s.get_title()+'" validation message...'),!1!==this.render_html&&s.$component_message.html(this.render_html),"progressive"===i.settings.layout?"transition"===this.event_type?setTimeout(function(){!1===e.render_html?s.$component_message.slideUp(200):s.$component_message.slideDown(200)},200):!1===this.render_html?s.$component_message.slideUp(200):s.$component_message.slideDown(200):"paged"===i.settings.layout&&(!1===e.render_html?s.$component_message.each(function(e,n){var o=!1,s=t(n);"paged"===i.settings.layout&&s.hasClass("top")&&(o=i.composite_viewport_scroller.illusion_scroll({target:s,type:"hide"})),!1===o&&s.slideUp(200)}):s.$component_message.each(function(e,n){var o=!1,s=t(n);"paged"===i.settings.layout&&s.hasClass("top")&&(o=i.composite_viewport_scroller.illusion_scroll({target:s,type:"show"})),!1===o&&s.slideDown(200)})),this.event_type=""}}))(o)},this.Component_Pagination_View=function(n,o){var s=n;return new(e.View.extend({template:!1,initialize:function(){this.template=wp.template("wc_cp_options_pagination"),this.listenTo(this.model,"change:page change:pages",this.render),s.$el.on("click",".component_pagination a.component_pagination_element",{view:this},this.load_page),s.$el.on("click",".component_pagination a.component_options_load_more",{view:this},this.load_more)},load_page:function(){t(this).blur();var e=parseInt(t(this).data("page_num"));return e>0&&(i.block(s.$component_options),s.component_options_view.$blocked_element=s.$component_options,s.component_options_view.update_options({page:e},"reload")),!1},load_more:function(){t(this).blur();var e=parseInt(s.component_options_model.get("page")),n=parseInt(s.component_options_model.get("pages"));return e>0&&e<n&&(i.block(s.$component_options),s.component_options_view.$blocked_element=s.$component_options,s.component_options_view.update_options({page:e+1},"append")),!1},render:function(){if(!i.is_initialized)return!1;var t=this.model,e={page:t.get("page"),pages:t.get("pages"),range_mid:s.get_pagination_range(),range_end:s.get_pagination_range("end"),pages_in_range:2*(s.get_pagination_range()+s.get_pagination_range("end"))+1,i18n_page_of_pages:wc_composite_params.i18n_page_of_pages.replace("%p",t.get("page")).replace("%t",t.get("pages"))};i.console_log("debug:views",'\nRendering "'+s.get_title()+'" options pagination...'),s.append_results()?e.page<e.pages?this.$el.slideDown(200):this.$el.slideUp(200):this.$el.html(this.template(e))}}))(o)},this.Component_Options_View=function(n,o){var s=n;return new(e.View.extend({templates:{dropdown:!1,thumbnails:!1,radios:!1},update_action:"",load_height:0,$blocked_element:!1,append_results_retry_count:0,changes:{dropdown:{changed:!1,to:""},thumbnails:{changed:!1,to:""},radios:{changed:!1,to:""},variations:{changed:!1,to:[]}},initialize:function(){this.templates.dropdown=wp.template("wc_cp_options_dropdown"),this.templates.thumbnails=wp.template("wc_cp_options_thumbnails"),this.templates.radios=wp.template("wc_cp_options_radio_buttons"),s.$el.on("click",".component_filter_option a",{view:this},this.activate_filter),s.$el.on("click",".component_filters a.reset_component_filter",{view:this},this.reset_filter),s.$el.on("click",".component_filters a.reset_component_filters",{view:this},this.reset_filters),s.$el.on("change",".component_ordering select",{view:this},this.order_by),s.$el.on("click",".component_filter_title label",{view:this},this.toggle_filter),"progressive"===i.settings.layout&&s.$el.on("click",".block_component_selections_inner",{view:this},this.clicked_blocked_area),s.has_options_style("thumbnails")&&(s.$el.on("click",".component_option_thumbnail",{view:this},this.clicked_thumbnail),s.$el.on("click","a.component_option_thumbnail_tap",{view:this},this.clicked_thumbnail_tap)),s.has_options_style("radios")&&(s.$el.on("change",".component_option_radio_buttons input",{view:this},this.clicked_radio),s.$el.on("click","a.component_option_radio_button_tap",{view:this},this.clicked_radio_tap)),i.actions.add_action("component_options_loaded_"+s.step_id,this.updated_options,10,this),i.actions.add_action("component_options_state_changed_"+s.step_id,this.render,10,this),"relative"===s.get_price_display_format()&&(i.actions.add_action("component_selection_changed",this.component_totals_changed_handler,100,this),i.actions.add_action("component_selection_content_changed",this.component_totals_changed_handler,100,this)),this.listenTo(this.model,"change:options_in_scenarios",this.options_in_scenarios_changed)},component_totals_changed_handler:function(t){s.step_id===t.step_id&&setTimeout(function(){s.component_options_view.render()},20)},options_in_scenarios_changed:function(){this.model.reload_options_on_scenarios_change()&&(i.block(s.$component_options),this.$blocked_element=s.$component_options,i.data_model.add_status_message(s.component_id,wc_composite_params.i18n_loading_options.replace("%s",s.get_title())),this.update_options({page:1},"reload",!0))},clicked_blocked_area:function(){return i.navigate_to_step(s),!1},clicked_thumbnail_tap:function(){return t(this).closest(".component_option_thumbnail").trigger("click"),!1},clicked_thumbnail:function(){if(t(this).blur(),s.$el.hasClass("disabled")||t(this).hasClass("disabled"))return!0;if(!t(this).hasClass("selected")){var e=t(this).data("val");s.$component_options_select.val(e).change()}},clicked_radio_tap:function(){return t(this).closest(".component_option_radio_button").find("input").trigger("click"),!1},clicked_radio:function(){var e=t(this).closest(".component_option_radio_button");if(s.$el.hasClass("disabled")||e.hasClass("disabled"))return!0;if(!e.hasClass("selected")){var i=t(this).val();s.$component_options_select.val(i).change()}},toggle_filter:function(){t(this).blur();var e=t(this).closest(".component_filter");return wc_cp_toggle_element(e,e.find(".component_filter_content")),!1},activate_filter:function(e){if(t(this).blur(),s.$el.hasClass("disabled"))return!1;var n=e.data.view,o=t(this).closest(".component_filter_option");return o.hasClass("selected")?o.removeClass("selected"):o.addClass("selected"),n.update_filters_ui(),i.block(s.$component_filters),n.$blocked_element=s.$component_filters,n.update_options({page:1,filters:s.find_active_filters()},"reload"),!1},reset_filter:function(e){t(this).blur();var n=e.data.view,o=t(this).closest(".component_filter").find(".component_filter_option.selected");return 0!=o.length&&(o.removeClass("selected"),n.update_filters_ui(),i.block(s.$component_filters),n.$blocked_element=s.$component_filters,n.update_options({page:1,filters:s.find_active_filters()},"reload"),!1)},reset_filters:function(e){t(this).blur();var n=e.data.view,o=s.$component_filters.find(".component_filter_option.selected");return 0!=o.length&&(o.removeClass("selected"),n.update_filters_ui(),i.block(s.$component_filters),n.$blocked_element=s.$component_filters,n.update_options({page:1,filters:s.find_active_filters()},"reload"),!1)},update_filters_ui:function(){var e=s.$component_filters.find(".component_filter"),i=!0;if(0==e.length)return!1;e.each(function(){0==t(this).find(".component_filter_option.selected").length?t(this).removeClass("active"):(t(this).addClass("active"),i=!1)}),i?s.$component_filters.removeClass("filtered"):s.$component_filters.addClass("filtered")},order_by:function(e){var n=e.data.view,o=t(this).val();return t(this).blur(),i.block(s.$component_options),n.$blocked_element=s.$component_options,n.update_options({page:1,orderby:o},"reload"),!1},render:function(e){if(!i.is_initialized)return!1;e=void 0!==e&&e,i.console_log("debug:views",'\nRendering "'+s.get_title()+'" options in view...');var n=s.component_options_model,o=s.get_price_display_format(),a=n.get("options_state").active,c=s.get_selected_product(!1),d=t.extend(!0,[],n.available_options_data),r=[];this.changes.dropdown.changed=!1,this.changes.thumbnails.changed=!1,this.changes.radios.changed=!1,this.changes.variations.changed=!1,t.each(d,function(t,e){var i=e.option_id,n=_.contains(a,i);d[t].is_disabled=!n,d[t].is_hidden=d[t].is_disabled&&s.hide_disabled_products(),d[t].is_selected=d[t].option_id===c,d[t].option_display_title=e.option_title,d[t].option_price_html=s.get_formatted_option_price_html(d[t])});var l=t.extend(!0,[],d);t.each(l,function(t,e){if(l[t].is_selected=e.is_selected&&s.is_selected_product_valid(),e.option_price_html&&s.has_options_style("dropdowns")){var i="relative"===o?wc_composite_params.i18n_dropdown_title_relative_price:wc_composite_params.i18n_dropdown_title_price;l[t].option_display_title=i.replace("%t",e.option_display_title).replace("%p",e.option_price_html)}});var p,u=!1,m=!1,h=!1;if(0===a.length?(u=!0,p=wc_composite_params.i18n_no_options):(p=s.is_optional()?wc_composite_params.i18n_no_option.replace("%s",s.get_title()):wc_composite_params.i18n_select_option.replace("%s",s.get_title()),s.maybe_is_optional()?(u=!0,!1===s.is_selected_product_valid()&&(m=!0),!1===s.is_optional()&&(""===c&&(m=!0),h=!0,p=wc_composite_params.i18n_no_option.replace("%s",s.get_title()))):!1===s.is_static()&&s.show_placeholder_option()?u=!0:""===c&&!1===s.show_placeholder_option()?u=!0:!1===s.is_selected_product_valid()&&!1===s.show_placeholder_option()&&(m=!0)),u){var g={option_id:"",option_display_title:p,is_disabled:h,is_hidden:h&&s.hide_disabled_products(),is_selected:""===c&&!1===m};if("relative"===o&&s.has_options_style("dropdowns")&&s.maybe_is_optional()){g.option_price_html="",g.option_price_data={price:0,regular_price:0,max_price:0,max_regular_price:0,min_qty:1,discount:""};var v=s.get_formatted_option_price_html(g);v&&(g.option_display_title=wc_composite_params.i18n_dropdown_title_relative_price.replace("%t",g.option_display_title).replace("%p",v))}l.unshift(g)}if(m&&(s.$component_options_select.data("has_extra_empty_option",!0),l.unshift({option_id:"",option_display_title:wc_composite_params.i18n_select_option.replace("%s",s.get_title()),is_disabled:!1,is_hidden:!1,is_selected:!1})),this.changes.dropdown.changed=!0,this.changes.dropdown.to=this.templates.dropdown(l),!1===e){if(s.has_options_style("thumbnails")){var f=_.where(d,{is_in_view:!0}),b=parseInt(s.$component_thumbnail_options.data("columns")),w=0;f.length>0&&t.each(f,function(t,e){f[t].outer_classes=e.is_hidden?"hidden":"",f[t].inner_classes=e.is_disabled?"disabled":"",f[t].inner_classes+=e.option_id===c?" selected":"",f[t].inner_classes+=e.is_appended?" appended":"",!1===e.is_hidden&&((++w-1)%b!=0&&1!=b||(f[t].outer_classes+=" first"),w%b==0&&(f[t].outer_classes+=" last"))});var y=this.templates.thumbnails(f);y.replace(/ selected/g,"")!==this.changes.thumbnails.to.replace(/ selected/g,"")?(this.changes.thumbnails.changed=!0,this.changes.thumbnails.to=y):i.console_log("debug:views","...skipped!")}else if(s.has_options_style("radios")){var $=_.where(d,{is_in_view:!0}),k=!1,x=s.maybe_is_optional()&&!1===s.is_optional(),C=x&&s.hide_disabled_products();if(s.maybe_is_optional()?k=!0:!1===s.is_static()&&s.show_placeholder_option()&&(k=!0,C=!0),k){var q={option_id:"",option_display_title:wc_composite_params.i18n_no_option.replace("%s",s.get_title()),is_disabled:x,is_hidden:C,is_selected:""===c};if("relative"===o&&s.maybe_is_optional()){q.option_price_html="",q.option_price_data={price:0,regular_price:0,max_price:0,max_regular_price:0,min_qty:1,discount:""};var z=s.get_formatted_option_price_html(q);z&&(q.option_price_html=z)}$.unshift(q)}$.length>0&&t.each($,function(t,e){$[t].outer_classes=e.is_hidden?"hidden":"",$[t].inner_classes=e.is_disabled?"disabled":"",$[t].inner_classes+=e.option_id===c?" selected":"",$[t].option_suffix=""===e.option_id?"0":e.option_id,$[t].option_group_id=s.component_id}),this.changes.radios.changed=!0,this.changes.radios.to=this.templates.radios($)}if("variable"===s.get_selected_product_type()){for(var S,T=s.get_selected_variation(!1),V=s.$component_data.data("product_variations"),M=[],U=0;U<V.length;U++){var A=V[U].variation_id.toString(),I=_.contains(a,A);if(!1===s.hide_disabled_variations()){var P=!1;if(S=t.extend(!0,{},V[U]),!I){S.variation_is_active=!1;for(var j in S.attributes)if(""===S.attributes[j]){P=!0;break}}P||M.push(S)}else I?M.push(V[U]):parseInt(T)===parseInt(A)&&((S=t.extend(!0,{},V[U])).variation_is_active=!1,M.push(S))}this.changes.variations.changed=!_.isEqual(s.$component_summary_content.data("product_variations"),M),this.changes.variations.to=M}}(r=_.keys(_.pick(this.changes,function(t){return t.changed}))).length>0&&(i.actions.do_action("component_options_state_render",[s,r]),this.changes.dropdown.changed&&s.$component_options_select.html(this.changes.dropdown.to),this.changes.thumbnails.changed&&s.$component_thumbnail_options.html(this.changes.thumbnails.to),this.changes.radios.changed&&s.$component_radio_button_options.html(this.changes.radios.to),this.changes.variations.changed&&(s.$component_summary_content.data("product_variations",this.changes.variations.to),s.$component_summary_content.triggerHandler("reload_product_variations")),i.actions.do_action("component_options_state_rendered",[s,r]))},update_options:function(t,e,n){n=void 0!==n&&n,this.update_action=e,"reload"===e&&s.$component_selections.addClass("refresh_component_options"),void 0!==s.$component_options.get(0).getBoundingClientRect().height?this.load_height=s.$component_options.get(0).getBoundingClientRect().height:this.load_height=s.$component_options.outerHeight(),s.$component_options.css("height",this.load_height),setTimeout(function(){s.component_options_model.request_options(t,e)},200),i.actions.do_action("component_options_update_requested",[s,t,e,n])},updated_options:function(){if(!1===this.$blocked_element)return!1;if("append"===this.update_action&&s.hide_disabled_products()&&s.$component_thumbnail_options.find(".appended:not(.disabled)").length<s.get_results_per_page()){var e=this.model.get("page")<this.model.get("pages");if(e&&this.append_results_retry_count>10&&!1===window.confirm(wc_composite_params.i18n_reload_threshold_exceeded.replace("%s",s.get_title()))&&(e=!1),e)return this.append_results_retry_count++,this.model.request_options({page:this.model.get("page")+1},"append"),!1;this.append_results_retry_count=0}var i=s.$component_thumbnail_options.find(".component_option_thumbnails_container"),n=i.find(".component_option_thumbnail_container:not(.hidden) img"),o=0,a=this,_=function(){if(n.length>0&&i.is(":visible")){var e=!1;n.each(function(){if(0===t(this).height()&&o<1e4)return e=!0,!1}),e?(o+=100,setTimeout(function(){_()},100)):a.animate_options()}else a.animate_options()};setTimeout(function(){_()},10)},animate_options:function(){var t=this,e=s.$component_options_inner.outerHeight(!0),n=!1;Math.abs(e-t.load_height)>1?n=!0:s.$component_options.css("height","auto");"append"===this.update_action&&s.$component_thumbnail_options.find(".appended").removeClass("appended"),n?("reload"===t.update_action&&s.$component_selections.removeClass("refresh_component_options"),s.$component_options.animate({height:e},{duration:250,queue:!1,always:function(){s.$component_options.css({height:"auto"}),setTimeout(function(){t.unblock()},100)}})):setTimeout(function(){t.unblock()},250),i.actions.do_action("component_options_updated",[s])},unblock:function(){s.$component_selections.removeClass("refresh_component_options"),i.unblock(this.$blocked_element),this.$blocked_element=!1,i.data_model.remove_status_message(s.component_id),i.actions.do_action("component_options_refreshed_"+s.step_id)},is_updating:function(){return!1!==this.$blocked_element}}))(o)},this.Component_Selection_View=function(n,o){var s=n;return new(e.View.extend({templates:{},$relocation_origin:!1,relocated:!1,relocating:!1,relocating_to_origin:!1,$relocation_target:!1,$relocation_reference:!1,load_height:0,flushing_component_options:!1,initialize:function(){this.templates={selection_title:wp.template("wc_cp_component_selection_title"),selection_title_html:""},s.$el.on("change",".component_options select.component_options_select",{view:this},this.option_changed),s.$el.on("woocommerce_variation_has_changed",{view:this},function(t){t.data.view.model.update_selected_variation(),s.step_validation_model.get("is_in_stock")&&s.$component_quantity.trigger("change"),s.$component_summary_content.find(".composited_product_images").removeClass("images")}),s.$el.on("woocommerce_variation_select_change",function(){s.$component_summary.find(".composited_product_images").addClass("images"),s.$component_data.data("price",0),s.$component_data.data("regular_price",0),s.$component_data.data("custom").price_tax=1}),s.$el.on("found_variation",function(t,e){s.$component_data.data("price",e.price),s.$component_data.data("regular_price",e.regular_price),s.$component_data.data("custom").price_tax=e.price_tax}),s.$el.on("input change",".component_wrap input.qty",function(e){var i=parseFloat(t(this).attr("min")),n=parseFloat(t(this).attr("max"));"change"===e.type&&i>=0&&(parseFloat(t(this).val())<i||isNaN(parseFloat(t(this).val())))&&t(this).val(i),"change"===e.type&&n>0&&parseFloat(t(this).val())>n&&t(this).val(n),s.initializing_scripts||s.component_selection_model.update_selected_quantity()}),s.$el.on("wc-composite-component-loaded",{view:this},function(){if("yes"===wc_composite_params.photoswipe_enabled&&"undefined"!=typeof PhotoSwipe){var e=s.$component_summary_content.find(".composited_product_images");e.wc_product_gallery({zoom_enabled:!1,flexslider_enabled:!1});var i=e.find("a.placeholder_image");i.length>0&&i.on("click",function(){return!1})}else if(t.isFunction(t.fn.prettyPhoto)){var n=s.$component_summary_content.find('a[data-rel^="prettyPhoto"]'),o=n.not(".placeholder_image"),a=n.filter(".placeholder_image");o.length>0&&o.prettyPhoto({hook:"data-rel",social_tools:!1,theme:"pp_woocommerce",horizontal_padding:20,opacity:.8,deeplinking:!1}),a.length>0&&a.on("click",function(){return!1})}}),s.$el.on("click",".clear_component_options",function(){if(t(this).hasClass("reset_component_options"))return!1;var e=s.$component_options_select.find('option[value=""]');return e.length>0&&!1===e.first().prop("disabled")&&s.$component_options_select.val("").change(),!1}),s.$el.on("click",".reset_component_options",function(){var t=s.$component_options_select.find('option[value=""]');return s.unblock_step_inputs(),s.set_active(),t.length>0&&!1===t.first().prop("disabled")&&s.$component_options_select.val("").change(),s.block_next_steps(),!1}),s.$el.on("updated_addons",this.updated_addons_handler),s.$el.on("woocommerce-nyp-updated-item",this.updated_nyp_handler),"yes"===wc_composite_params.relocated_content_reset_on_return&&i.actions.add_action("active_step_transition_start",this.active_step_transition_start_handler,100,this),i.actions.add_action("component_options_state_changed_"+s.step_id,this.options_state_changed_handler,100,this),i.actions.add_action("component_options_state_render",this.options_state_render_handler,10,this),i.actions.add_action("component_options_state_rendered",this.options_state_rendered_handler,10,this),i.actions.add_action("component_options_state_rendered",this.autoselect_attributes,30,this),i.actions.add_action("component_selection_changed",this.refresh_selection_title,100,this),this.listenTo(this.model,"component_selection_details_loaded",this.selection_details_loaded),this.listenTo(this.model,"component_selection_details_load_error",this.selection_details_load_error),this.listenTo(s.component_options_model,"component_options_data_loaded",this.component_options_flush_handler),i.actions.add_action("component_quantity_changed",this.quantity_changed_handler,100,this)},get_animation_duration:function(t){return t="open"!==t&&"close"!==t?"open":t,i.filters.apply_filters("component_selection_change_animation_duration",[220,t,s])},active_step_transition_start_handler:function(t){s.step_id!==t.step_id&&this.is_relocated()&&this.reset_relocated_content()},options_state_changed_handler:function(){this.update_selection_title()},options_state_render_handler:function(t,e){s.step_id===t.step_id&&_.contains(e,"thumbnails")&&this.is_relocated()&&s.$el.append(this.$relocation_target.hide())},options_state_rendered_handler:function(t,e){if(s.step_id===t.step_id&&_.contains(e,"thumbnails")&&this.is_relocated()){var i=this.get_new_relocation_data();i.relocate&&(this.$relocation_reference=i.reference,this.$relocation_reference.after(this.$relocation_target),this.$relocation_target.show())}},autoselect_attributes:function(e,i){if(s.step_id===e.step_id&&e.autoselect_attributes()&&_.contains(i,"variations")){var n=_.where(s.component_options_view.changes.variations.to,{variation_is_active:!0});if(1===n.length){var o=n[0].attributes,a=!1;for(var c in o)if(""===o[c]){a=!0;break}if(!a){var d=s.$component_summary_content.find(".variations select"),r=!1;d.each(function(e,i){var n=t(i),o=!n.val()&&n.find('option.attached.enabled[value!=""]:first'),s=!!o&&o.val();s&&(r=!0,n.val(s))}),r&&d.last().change()}}}},quantity_changed_handler:function(t){t.step_id===s.step_id&&this.update_selection_title(this.model)},updated_addons_handler:function(t){s.component_selection_model.update_selected_addons();var e=i.data_model.price_data,n=e.addons_prices[s.component_id];if(n||(n=0),s.show_addons_totals)if(s.passes_validation()){var o=s.get_selected_quantity(),a=Number(e.prices_tax[s.component_id]),_=i.data_model.get_taxed_totals(n,n,a,o);if(_.price>0){var c=Number(e.prices[s.component_id])+Number(n),d=i.data_model.get_taxed_totals(c,c,a,o),r=wc_cp_price_format(d.price),l=i.composite_price_view.get_formatted_price_suffix(d),p="";p='<dl class="product-addon-totals"><dt>'+woocommerce_addons_params.i18n_addon_total+'</dt><dd><strong><span class="amount">'+wc_cp_price_format(_.price)+"</span></strong></dd>",p+="<dt>"+woocommerce_addons_params.i18n_sub_total+"</dt><dd><strong>"+r+l+"</strong></dd></dl>",s.$component_addons_totals.html(p)}else s.$component_addons_totals.empty()}else s.$component_addons_totals.empty();t.stopPropagation()},updated_nyp_handler:function(){s.component_selection_model.update_nyp()},refresh_selection_title:function(t){t.step_id===s.step_id&&this.update_selection_title(this.model)},update_selection_title:function(t){var e=this;t=void 0===t?e.model:t,s.get_selected_product(!1)>0&&(i.console_log("debug:views",'\nUpdating "'+s.get_title()+'" selection title...'),e.update_selection_title_task(t))},get_updated_selection_title:function(t){var e=parseInt(t.get("selected_quantity")),i=s.get_selected_product_title(!1),n=e>1?wc_composite_params.i18n_qty_string.replace("%s",e):"";return wc_composite_params.i18n_title_string.replace("%t",i).replace("%q",n).replace("%p","")},update_selection_title_task:function(t){var e=s.$component_summary_content.find(".composited_product_title_wrapper"),n=this,o={tag:"single"===i.settings.layout||"progressive"===i.settings.layout?"p":"h4",show_title:"yes"===e.data("show_title"),show_selection_ui:!s.is_static(),show_reset_ui:s.show_placeholder_option()&&!1===s.maybe_is_optional()||s.is_optional()||!1===s.is_selected_product_valid(),selection_title:n.get_updated_selection_title(t)},a=n.templates.selection_title(o);if(a!==n.templates.selection_title_html&&(n.templates.selection_title_html=a,e.html(a)),"invalid-product"===s.get_selected_product_type()){var _=s.$component_options_select.find('option[value=""]');(0===_.length||_.first().prop("disabled"))&&s.$component_summary_content.find(".clear_component_options").remove()}},init_dependencies:function(){s.init_scripts()},block:function(){i.block(s.$component_options)},unblock:function(){i.unblock(s.$component_options)},option_changed:function(e){var i=e.data.view,n=t(this).val();return t(this).blur(),i.set_option(n),!1},set_option:function(t){var e=this;if(s.get_selected_product(!1)===t)return!1;if(s.has_options_style("thumbnails"))s.$component_thumbnail_options.find(".selected").removeClass("selected"),s.$component_thumbnail_options.find("#component_option_thumbnail_"+t).addClass("selected");else if(s.has_options_style("radios")){var i=s.$component_radio_button_options.find(".selected");i.removeClass("selected"),i.find("input").prop("checked",!1),s.$component_options.find("#component_option_radio_button_"+(""===t?"0":t)).addClass("selected").find("input").prop("checked",!0)}""!==t?(this.block(),s.$component_content.addClass("updating"),setTimeout(function(){e.model.request_details(t)},120)):(this.model.selected_product="",this.selection_details_loaded(!1))},selection_details_load_error:function(){var t=s.get_selected_product(!1);if(s.$component_options_select.val(t).change(),this.unblock(),s.has_options_style("thumbnails"))s.$component_thumbnail_options.find(".selected").removeClass("selected"),s.$component_thumbnail_options.find("#component_option_thumbnail_"+t).addClass("selected");else if(s.has_options_style("radios")){var e=s.$component_radio_button_options.find(".selected");e.removeClass("selected"),e.find("input").prop("checked",!1),s.$component_options.find("#component_option_radio_button_"+(""===t?"0":t)).addClass("selected").find("input").prop("checked",!0)}s.$component_content.removeClass("updating"),window.alert(wc_composite_params.i18n_selection_request_timeout)},selection_details_loaded:function(e){var n=this,o=this.model.selected_product,a=this.can_relocate();if(void 0!==s.$component_content.get(0).getBoundingClientRect().height?n.load_height=s.$component_content.get(0).getBoundingClientRect().height:n.load_height=s.$component_content.outerHeight(),n.relocating=!1,n.relocating_to_origin=!1,a&&!1===n.$relocation_origin&&(n.$relocation_origin=t('<div class="component_content_origin">'),s.$component_content.before(n.$relocation_origin)),a&&""!==o){var _=n.get_new_relocation_data();_.relocate&&(n.$relocation_reference=_.reference,n.relocating=_.relocate)}else n.is_relocated()&&(n.relocating=!0,n.relocating_to_origin=!0);if(n.relocating&&(i.actions.do_action("component_selection_details_relocation_started",[s]),s.$component_content.addClass("relocating")),o)if(n.relocating)if(n.relocating_to_origin)s.$component_content.animate({height:0},{duration:n.get_animation_duration("close"),queue:!1,always:function(){n.reset_relocated_content(),n.update_content(e.markup)}}),n.load_height=0;else{if(s.$component_content.offset().top<n.$relocation_reference.offset().top&&!1===s.$component_content.wc_cp_is_in_viewport(!0)){var c=0,d=n.load_height;setTimeout(function(){c=$wc_cp_window.scrollTop()-Math.round(d),setTimeout(function(){window.scroll(0,c),s.$component_content.css({height:0}),setTimeout(function(){n.update_content(e.markup)},10)},50)},50)}else s.$component_content.animate({height:0},{duration:n.get_animation_duration("close"),queue:!1,always:function(){n.update_content(e.markup)}});n.load_height=0}else s.$component_content.css("height",n.load_height),n.update_content(e.markup);else s.$component_data.data("product_type","none"),s.$component_data.data("custom",!1),s.$component_data.data("price",0),s.$component_data.data("regular_price",0),!1===n.is_relocated()&&this.model.update_selected_product(),s.$component_content.animate({height:0},{duration:n.get_animation_duration("close"),queue:!1,always:function(){n.reset_content(),s.$component_content.css({height:"auto"})}})},update_content:function(e){var n=this;s.reset_scripts(),n.relocating&&(n.is_relocated()?n.$relocation_reference.after(n.$relocation_target):(n.$relocation_target=t('<li class="component_option_content_container">'),n.$relocation_reference.after(n.$relocation_target),s.$component_content.appendTo(n.$relocation_target),i.actions.do_action("component_selection_details_relocation_container_created",[s])),n.relocated=!0,s.$component_content.addClass("relocated")),s.$component_summary_content.addClass("populated"),s.$component_summary_content.html(e),this.templates.selection_title_html="",n.updated_content(),setTimeout(function(){n.animate_updated_content(),n.is_relocated()&&s.$component_content.removeClass("relocating")},300)},animate_updated_content:function(t){var e=this,i=void 0!==t&&void 0!==t.waited?parseInt(t.waited):0,n=void 0!==t&&void 0!==t.product_image?t.product_image:[];0===i&&(n=s.$component_summary_content.find(".composited_product_images img")),n.length>0&&0===n.height()&&i<1e3?(i+=50,setTimeout(function(){e.animate_updated_content({waited:i,product_image:n})},50)):e.animate_updated_content_task()},updated_content:function(){this.model.selected_product>0?s.init_scripts():s.init_scripts(!1),this.model.update_selected_product(),s.component_options_model.refresh_options_state(s),!0===s.$component_options_select.data("has_extra_empty_option")&&(s.$component_options_select.data("has_extra_empty_option",!1),s.component_options_view.render(!0)),i.actions.do_action("component_selection_details_updated",[s])},animate_updated_content_task:function(){var t=s.$component_summary.outerHeight(!0),e=!1,n=this;n.is_relocating()||Math.abs(t-this.load_height)>1?e=!0:s.$component_content.css("height","auto"),e?(i.console_log("debug:events","Starting updated content animation..."),s.$component_content.animate({height:t},{duration:n.get_animation_duration("open"),queue:!1,always:function(){i.console_log("debug:events","Ended updated content animation."),s.$component_content.css({height:"auto"}),n.unblock(),s.$component_content.removeClass("updating"),i.actions.do_action("component_selection_details_animated",[s])}})):(n.unblock(),s.$component_content.removeClass("updating"),i.actions.do_action("component_selection_details_animated",[s]))},reset_content:function(){s.reset_scripts(),s.$component_summary_content.html('<div class="component_data" data-price="0" data-regular_price="0" data-product_type="none" style="display:none;"></div>'),s.$component_summary_content.removeClass("populated"),s.$el.find(".composite_navigation.movable").length>0&&i.$composite_navigation_movable.addClass("hidden"),this.templates.selection_title_html="",this.reset_relocated_content(),this.updated_content(),s.$component_content.removeClass("relocating")},component_options_flush_handler:function(t,e){this.is_relocated()&&"reload"===e&&"success"===t.result&&(this.flushing_component_options=!0,s.$component_content.hide(),this.reset_relocated_content(),this.flushing_component_options=!1)},reset_relocated_content:function(){var t=this;this.is_relocated()&&(t.$relocation_origin.after(s.$component_content),i.actions.do_action("component_selection_details_relocation_ended",[s]),t.$relocation_origin.remove(),t.$relocation_target.remove(),t.$relocation_origin=!1,t.$relocation_target=!1,t.$relocation_reference=!1,t.relocated=!1,s.$component_content.removeClass("relocated"))},can_relocate:function(){return!("paged"!==i.settings.layout||!s.append_results()||!s.has_options_style("thumbnails")||"off"===s.get_relocation_mode()||!this.is_relocated()&&"forced"!==s.get_relocation_mode()&&!1!==s.$component_content.wc_cp_is_in_viewport(!0))},is_relocated:function(){return this.relocated},is_relocating:function(){return this.relocating},get_new_relocation_data:function(){var t=!1,e=!1,i=s.$component_options.find(".component_option_thumbnail.selected").closest(".component_option_thumbnail_container"),n=i.outerWidth(!0)/s.$component_options.outerWidth(),o=i.hasClass("last")||n>.6?i:i.nextAll(".last").first();return 0===(e=o.length>0?o:s.$component_options.find(".component_option_thumbnail_container").last()).next(".component_option_content_container").length&&(t=!0),{relocate:t,reference:e}}}))(o)},this.Step_Title_View=function(n,o){var s=n;return new(e.View.extend({$step_title_index:!1,initialize:function(){this.$step_title_index=s.$step_title.find(".step_index"),n.is_component&&s.has_toggle()&&(this.$el.on("click",this.clicked_title_handler),"progressive"===i.settings.layout&&(i.actions.add_action("step_access_changed",this.step_access_changed_handler,100,this),i.actions.add_action("active_step_changed",this.active_step_changed_handler,100,this))),!1!==this.$step_title_index&&i.actions.add_action("step_visibility_changed",this.step_visibility_changed_handler,100,this)},clicked_title_handler:function(){if(t(this).blur(),!s.has_toggle())return!1;if("single"===i.settings.layout)wc_cp_toggle_element(s.$el,s.$component_inner);else{if(s.is_current())return!1;if(t(this).hasClass("inactive"))return!1;i.navigate_to_step(s)}return!1},step_access_changed_handler:function(t){t.step_id===s.step_id&&this.render_navigation_state()},active_step_changed_handler:function(){this.render_navigation_state()},render_navigation_state:function(){"progressive"===i.settings.layout&&s.has_toggle()&&(i.console_log("debug:views",'\nUpdating "'+s.get_title()+'" component title state...'),s.is_current()?this.$el.removeClass("inactive"):s.is_locked()?this.$el.addClass("inactive"):this.$el.removeClass("inactive"))},render_index:function(){if(!i.is_initialized)return!1;if(!1===this.$step_title_index)return!1;var t=n.get_title_index();this.$step_title_index.text(t)},step_visibility_changed_handler:function(t){if(s.step_index<t.step_index)return!1;this.render_index()}}))(o)}},n.WC_CP_Actions_Dispatcher=function(e){var i=this,n={},o={add_action:function(t,e,i,o){var s={callback:e,priority:i,context:o},a=n[t];a?(a.push(s),a=this.sort_actions(a)):a=[s],n[t]=a},remove_action:function(t,e,i){var o,s,a;if(n[t])if(e)if(o=n[t],i)for(a=o.length;a--;)(s=o[a]).callback===e&&s.context===i&&o.splice(a,1);else for(a=o.length;a--;)o[a].callback===e&&o.splice(a,1);else n[t]=[]},sort_actions:function(t){for(var e,i,n,o=1,s=t.length;o<s;o++){for(e=t[o],i=o;(n=t[i-1])&&n.priority>e.priority;)t[i]=t[i-1],--i;t[i]=e}return t},do_action:function(t,e){var i,o,s=n[t];if(!s)return!1;for(o=s.length,i=0;i<o;i++)s[i].callback.apply(s[i].context,e);return!0}};this.init=function(){e.console_log("debug:events","\nInitializing Actions Dispatcher..."),t.each(e.get_steps(),function(t,n){n.is_component()&&(n.component_selection_model.on("change:selected_product change:selected_variation",function(){n.initializing_scripts||i.do_action("component_selection_changed",[n])}),n.component_selection_model.on("change:selected_quantity",function(){i.do_action("component_quantity_changed",[n])}),n.component_selection_model.on("change:selected_addons",function(){n.initializing_scripts||i.do_action("component_addons_changed",[n])}),n.component_selection_model.on("change:selected_nyp",function(){n.initializing_scripts||i.do_action("component_nyp_changed",[n])}),n.component_options_model.on("change:options_state",function(){i.do_action("component_options_state_changed",[n])}),n.component_options_model.on("change:active_options",function(){i.do_action("active_options_changed",[n])}),n.component_options_model.on("change:available_options",function(){i.do_action("available_options_changed",[n])}),e.data_model.on("change:component_"+n.step_id+"_totals",function(){i.do_action("component_totals_changed",[n])}),n.$el.on("woocommerce-composited-product-update",function(){n.initializing_scripts||i.do_action("component_selection_changed",[n])})),n.step_access_model.on("change:is_locked",function(){i.do_action("step_access_changed",[n])}),n.step_visibility_model.on("change:is_visible",function(){i.do_action("step_visibility_changed",[n])}),n.step_validation_model.on("change:composite_messages",function(){n.initializing_scripts||i.do_action("component_validation_message_changed",[n])}),n.step_validation_model.on("change:is_in_stock",function(){n.initializing_scripts||i.do_action("component_availability_changed",[n])})}),i.add_action("show_step",function(t){i.do_action("show_step_"+t.step_id)},0,this),i.add_action("active_step_changed",function(t){i.do_action("active_step_changed_"+t.step_id)},0,this),i.add_action("active_step_transition_start",function(t){i.do_action("active_step_transition_start_"+t.step_id)},0,this),i.add_action("active_step_transition_end",function(t){i.do_action("active_step_transition_end_"+t.step_id)},0,this),i.add_action("component_options_state_changed",function(t){i.do_action("component_options_state_changed_"+t.step_id)},0,this),i.add_action("active_options_changed",function(t){i.do_action("active_options_changed_"+t.step_id)},0,this),i.add_action("available_options_changed",function(t){i.do_action("available_options_changed_"+t.step_id)},0,this),i.add_action("component_options_loaded",function(t){i.do_action("component_options_loaded_"+t.step_id),t.$el.trigger("wc-composite-component-options-loaded",[t,e])},0,this),i.add_action("component_scripts_initialized",function(t){i.do_action("component_scripts_initialized_"+t.step_id),t.$el.trigger("wc-composite-component-loaded",[t,e])},0,this),i.add_action("component_scripts_reset",function(t){i.do_action("component_scripts_reset_"+t.step_id),t.$el.trigger("wc-composite-component-unloaded",[t,e])},0,this),e.scenarios.on("active_scenarios_changed",function(t){i.do_action("active_scenarios_changed",[t])}),e.scenarios.on("active_scenarios_updated",function(t){i.do_action("active_scenarios_updated",[t])}),e.data_model.on("change:totals",function(){i.do_action("composite_totals_changed")}),e.data_model.on("change:passes_validation",function(){i.do_action("composite_validation_status_changed")}),e.data_model.on("change:validation_messages",function(){i.do_action("composite_validation_message_changed")}),e.data_model.on("change:is_in_stock",function(){i.do_action("composite_availability_status_changed")}),e.data_model.on("change:stock_statuses",function(){i.do_action("composite_availability_message_changed")})},this.add_action=function(t,e,n,s){return"string"==typeof t&&"function"==typeof e&&(n=parseInt(n||10,10),o.add_action(t,e,n,s)),i},this.do_action=function(t,e){return"string"==typeof t&&o.do_action(t,e),i},this.remove_action=function(t,e){return"string"==typeof t&&o.remove_action(t,e),i}},n.WC_CP_Filters_Manager=function(){var t=this,e={},i={add_filter:function(t,i,n,o){var s={callback:i,priority:n,context:o},a=e[t];a?(a.push(s),a=this.sort_filters(a)):a=[s],e[t]=a},remove_filter:function(t,i,n){var o,s,a;if(e[t])if(i)if(o=e[t],n)for(a=o.length;a--;)(s=o[a]).callback===i&&s.context===n&&o.splice(a,1);else for(a=o.length;a--;)o[a].callback===i&&o.splice(a,1);else e[t]=[]},sort_filters:function(t){for(var e,i,n,o=1,s=t.length;o<s;o++){for(e=t[o],i=o;(n=t[i-1])&&n.priority>e.priority;)t[i]=t[i-1],--i;t[i]=e}return t},apply_filters:function(t,i){var n,o,s=e[t];if(!s)return i[0];for(o=s.length,n=0;n<o;n++)i[0]=s[n].callback.apply(s[n].context,i);return i[0]}};this.add_filter=function(e,n,o,s){return"string"==typeof e&&"function"==typeof n&&(o=parseInt(o||10,10),i.add_filter(e,n,o,s)),t},this.apply_filters=function(t,e){if("string"==typeof t)return i.apply_filters(t,e)},this.remove_filter=function(e,n){return"string"==typeof e&&i.remove_filter(e,n),t}},n.WC_CP_Scenarios_Manager=function(i){var n=this,o={updating_scenarios:!1,scenario_data:i.$composite_data.data("scenario_data"),active_scenarios:[],invalid_product_step_indexes:[],invalid_variation_step_indexes:[]};_.extend(n,e.Events),this.init=function(){i.actions.add_action("available_options_changed",this.available_options_changed_handler,-10,this),i.actions.add_action("component_selection_changed",this.selection_changed_handler,10,this),i.actions.add_action("step_visibility_changed",this.step_visibility_changed_handler,5,this),i.console_log("debug:events","\nInitializing Scenarios Manager..."),i.debug_tab_count=i.debug_tab_count+2,n.update_active_scenarios(_.first(i.steps),!1,!1),i.debug_tab_count=i.debug_tab_count-2,i.console_log("debug:events","\nScenarios Manager initialized.\n")},this.has_invalid_product=function(t){return _.contains(o.invalid_product_step_indexes,t)},this.has_invalid_variation=function(t){return _.contains(o.invalid_variation_step_indexes,t)},this.get_active_scenarios=function(){return o.active_scenarios},this.get_invalid_step_indexes=function(){return _.sortBy(_.uniq(_.union(o.invalid_product_step_indexes,o.invalid_variation_step_indexes)),function(t){return t})},this.get_scenario_data=function(){return o.scenario_data},this.set_component_scenario_data=function(t,e){o.scenario_data.scenario_data[t]=e},this.merge_component_scenario_data=function(e,i){t.each(i,function(t,i){o.scenario_data.scenario_data[e][t]=i})},this.step_visibility_changed_handler=function(t){i.console_log("debug:scenarios",'\nUpdating active scenarios in response to "'+t.get_title()+'" visibility state change...'),this.update_active_scenarios(t)},this.selection_changed_handler=function(t){i.console_log("debug:scenarios",'\nUpdating active scenarios in response to "'+t.get_title()+'" selection state change...'),this.update_active_scenarios(t)},this.available_options_changed_handler=function(t){i.console_log("debug:scenarios",'\nUpdating active scenarios in response to "'+t.get_title()+'" options state change...'),this.update_active_scenarios(t)},this.update_active_scenarios=function(t){if(t.initializing_scripts)return i.console_log("debug:scenarios","Breaking out - event triggered during script init...\n\n"),!1;i.console_log("debug:scenarios","\nClearing incompatible products/variations data..."),o.invalid_product_step_indexes=[],o.invalid_variation_step_indexes=[];var e=o.active_scenarios;o.updating_scenarios=!0;var s=this.calculate_active_scenarios(t,!1,!1);o.updating_scenarios=!1,e.length!==s.length||e.length!==_.intersection(e,s).length?(i.console_log("debug:scenarios","\nActive scenarios changed: - ["+e+"] => ["+s+"]"),o.active_scenarios=s,n.trigger("active_scenarios_changed",t)):i.console_log("debug:scenarios","\nActive scenarios unchanged."),n.trigger("active_scenarios_updated",t)},this.calculate_active_scenarios=function(e,s,a){var c=e.step_index,d=n.get_scenario_data().scenarios,r=n.filter_scenarios_by_type(d,"compat_group");e.is_review()&&(c=1e3),0===r.length&&d.push("0");var l=d,p=[];o.updating_scenarios||i.console_log("debug:scenarios",'\nScenarios requested by "'+e.get_title()+'"...'),i.console_log("debug:scenarios","\nCalculating active scenarios..."),t.each(i.get_components(),function(t,e){if(a&&parseInt(e.step_index)===parseInt(c))return!0;if(s&&e.step_index>c)return!1;var d=e.get_selected_product(!1,!0),r=e.get_selected_product_type();if(null!==d&&d>=0){var u=n.get_scenario_data().scenario_data[e.component_id];if(""===d){if(!(0 in u))return!0;d="0"}var m=d in u?u[d]:[];i.console_log("debug:scenarios","Selection #"+d+' of "'+e.get_title()+'" in scenarios: ['+m+"]");var h=_.intersection(l,m),g=h.length>0,v="",f=!0;if(g&&"variable"===r&&(v=e.get_selected_variation(!1))>0){var b=v in u?u[v]:[];i.console_log("debug:scenarios","Variation selection #"+v+' of "'+e.get_title()+'" in scenarios: ['+b+"]"),f=(h=_.intersection(h,b)).length>0}if(g&&f)p.push(e.component_id),l=h,i.console_log("debug:scenarios","Active scenarios: ["+l+"]");else if(g){if(!f){var w="Incompatible variation selection found...";o.updating_scenarios&&v>0&&(w+=" saved.",o.invalid_variation_step_indexes.push(e.step_index)),i.console_log("debug:scenarios",w)}}else{var y="Incompatible product selection found...";o.updating_scenarios&&d>0&&(y+=" saved.",o.invalid_product_step_indexes.push(e.step_index)),i.console_log("debug:scenarios",y)}}}),i.console_log("debug:scenarios","Removing active scenarios where all scenario shaping components ("+p+") are masked...");var u=n.get_binding_scenarios(l,p);return i.console_log("debug:scenarios","Calculated active scenarios: ["+u+"]\n"),u},this.get_binding_scenarios=function(e,i){var n=this.get_scenario_data().scenario_settings.masked_components,o=[];if(i.length>0){if(e.length>0)for(var s=0;s<e.length;s++){for(var a=e[s],_=!0,c=0;c<i.length;c++){var d=i[c];if(-1==t.inArray(d.toString(),n[a])){_=!1;break}}_||o.push(a)}}else o=e;return 0===o.length&&e.length>0&&(o=e),o},this.get_active_scenarios_by_type=function(t){return this.filter_scenarios_by_type(o.active_scenarios,t)},this.get_scenarios_by_type=function(t){return this.filter_scenarios_by_type(this.get_scenario_data().scenarios,t)},this.filter_scenarios_by_type=function(e,i){var n=[],o="";if(e.length>0)for(var s=0;s<e.length;s++)o=e[s],("all"===i||t.inArray(i,this.get_scenario_data().scenario_settings.scenario_actions[o])>-1)&&n.push(o);return n},this.clean_masked_scenarios=function(e,i){var n=this.get_scenario_data().scenario_settings.masked_components,o=[],s="";if(e.length>0)for(var a=0;a<e.length;a++)s=e[a],-1==t.inArray(i.toString(),n[s])&&o.push(s);return o},this.get_masked_scenarios=function(e,i){var n=this.get_scenario_data().scenario_settings.masked_components,o=[],s="";if(e.length>0)for(var a=0;a<e.length;a++)s=e[a],t.inArray(i.toString(),n[s])>-1&&o.push(s);return o}},n.WC_CP_Step_Factory=function(){function e(e,i,n){var o=this;this.step_id=i.data("item_id"),this.step_index=n,this.step_title=i.data("nav_title"),this.step_slug=e.$composite_data.data("composite_settings").slugs[this.step_id],this._component_messages=[],this._composite_messages=[],this._is_component=i.hasClass("component"),this._is_review=i.hasClass("cart"),this._is_current=i.hasClass("active"),this._is_previous=i.hasClass("prev"),this._is_next=i.hasClass("next"),this._toggled=i.hasClass("toggled"),this._autotransition=i.hasClass("autotransition"),this._autoselect_attributes=i.hasClass("autoselect_attributes"),this.$el=i,this.$inner_el=i.find(".component_inner"),this.$step_title=i.find(".step_title_wrapper"),this.$self=i,this.add_actions=function(){e.actions.add_action("step_visibility_changed",this.step_visibility_changed_handler,10,this)},this.step_visibility_changed_handler=function(){if("paged"!==e.settings.layout&&(!1===o.is_visible()?e.is_initialized?o.$el.slideUp(200):o.$el.hide():o.$el.slideDown(200)),!e.is_initialized)return!1;this.is_current()&&e.set_current_step(e.get_current_step())},this.autotransition=function(){return this._autotransition},this.autoselect_attributes=function(){return this._autoselect_attributes},this.is_animating=function(){return this.$el.hasClass("animating")},this.has_toggle=function(){return this._toggled},this.is_locked=function(){var t=this.step_access_model.get("is_locked");return e.filters.apply_filters("step_is_locked",[t,this])},this.is_visible=function(){return this.step_visibility_model.get("is_visible")},this.lock=function(){this.step_access_model.set({locked:!0})},this.unlock=function(){this.step_access_model.set({locked:!1})},this.get_title_index=function(){var t=_.filter(e.get_steps(),function(t){if(!1===t.step_visibility_model.get("is_visible")&&t.step_index<o.step_index)return t}).length;return this.step_index+1-t},this.get_title=function(){return this.step_title},this.get_element=function(){return this.$el},this.is_review=function(){return this._is_review},this.is_component=function(){return this._is_component},this.get_component=function(){return!!this._is_component&&this},this.is_current=function(){return this._is_current},this.is_next=function(){return this._is_next},this.is_previous=function(){return this._is_previous},this.show_step=function(){if(this.is_locked()||this.is_animating())return!1;var t=this.is_current();"single"===e.settings.layout&&this.toggle_step("open",!0),t&&e.is_initialized||this.set_active(),e.actions.do_action("show_step",[this])},this.set_active=function(){var t=this,i=e.settings.layout,n=e.get_current_step(),o=n.$el,s=t.$el,a=0;e.set_current_step(t),n.step_id!==t.step_id?"paged"===i?(e.$composite_form_blocker.addClass("blocked"),e.has_transition_lock=!0,setTimeout(function(){o.addClass("faded"),s.addClass("invisible faded"),setTimeout(function(){a=void 0!==o.get(0).getBoundingClientRect().height?o.get(0).getBoundingClientRect().height:o.outerHeight(),o.addClass("invisible"),o.css("height",a),e.actions.do_action("active_step_transition_start",[t]),e.console_log("debug:events","Starting transition..."),o.slideUp({duration:150,always:function(){o.css("height","auto")}}),s.slideDown({duration:150,always:function(){setTimeout(function(){e.actions.do_action("active_step_transition_end",[t])},250),e.console_log("debug:events","Transition ended."),setTimeout(function(){e.$steps.removeClass("faded invisible")},10),e.has_transition_lock=!1,e.$composite_form_blocker.removeClass("blocked")}})},250)},10)):("progressive"===i&&t.update_block_state(),e.has_transition_lock=!0,setTimeout(function(){e.actions.do_action("active_step_transition_start",[t])},5),setTimeout(function(){e.actions.do_action("active_step_transition_end",[t]),e.has_transition_lock=!1},350)):t.$el.show(),e.actions.do_action("active_step_changed",[this])},this.update_block_state=function(){if("progressive"!==e.settings.layout)return!1;t.each(e.get_steps(),function(t,e){e.step_index<o.step_index&&(e.block_step_inputs(),e.$el.hasClass("block-open")||e.toggle_step("closed",!0))}),this.unblock_step_inputs(),this.unblock_step(),this.block_next_steps()},this.unblock_step=function(){this.toggle_step("open",!0),this.$el.removeClass("blocked")},this.block_next_steps=function(){var i=this.step_index;t.each(e.get_steps(),function(t,e){t>i&&(e.$el.hasClass("disabled")&&e.unblock_step_inputs(),e.block_step())})},this.block_step=function(){this.$el.addClass("blocked"),this.toggle_step("closed",!1)},this.toggle_step=function(t,e,i){this.has_toggle()&&("open"===t?this.$el.hasClass("closed")&&wc_cp_toggle_element(this.$el,this.$inner_el,i):"closed"===t&&this.$el.hasClass("open")&&wc_cp_toggle_element(this.$el,this.$inner_el,i),e?this.$step_title.removeClass("inactive"):this.$step_title.addClass("inactive"))},this.unblock_step_inputs=function(){this.$el.removeClass("disabled"),this.$el.find(".clear_component_options").html(wc_composite_params.i18n_clear_selection).removeClass("reset_component_options")},this.block_step_inputs=function(){this.$el.addClass("disabled"),o.has_toggle()&&!o.$el.hasClass("block-open")||this.$el.find(".clear_component_options").html(wc_composite_params.i18n_reset_selection).addClass("reset_component_options")},this.is_blocked=function(){return this.$el.hasClass("blocked")},this.has_blocked_inputs=function(){return this.$el.hasClass("disabled")},this.add_validation_message=function(t,e){"composite"===(e=void 0===e?"component":e)?this._composite_messages.push(t.toString()):this._component_messages.push(t.toString())},this.get_validation_messages=function(t){var i;return t=void 0===t?"component":t,i="composite"===t?this._composite_messages:this._component_messages,e.filters.apply_filters("step_validation_messages",[i,t,this])},this.validate=function(){if(o.initializing_scripts)return!1;var t=!0,i=!0;if(this._component_messages=[],this._composite_messages=[],this.is_component()){var n=this.get_selected_product(),s=this.get_selected_product_type();(t=this.has_valid_selections())||(n>0?"invalid-product"===s?this.add_validation_message(wc_composite_params.i18n_item_unavailable_text,"composite"):"variable"===s&&(this.is_selected_variation_valid()?(this.add_validation_message(wc_composite_params.i18n_select_product_options),this.add_validation_message(wc_composite_params.i18n_select_product_options_for,"composite")):this.add_validation_message(wc_composite_params.i18n_selected_product_options_invalid,"composite")):this.is_selected_product_valid()?(this.add_validation_message(wc_composite_params.i18n_select_component_option),this.add_validation_message(wc_composite_params.i18n_select_component_option_for,"composite")):(this.add_validation_message(wc_composite_params.i18n_selected_product_invalid),this.add_validation_message(wc_composite_params.i18n_selected_product_invalid,"composite"))),this.is_in_stock()||(i=!1)}t=e.filters.apply_filters("step_is_valid",[t,this]),e.actions.do_action("validate_step",[this,t]),this.step_validation_model.update(t,i)},this.passes_validation=function(){return this.step_validation_model.get("passes_validation")},this.add_actions()}function i(i,n,o){e.call(this,i,n,o);var s=this;this.initializing_scripts=!1,this.component_index=o,this.component_id=n.attr("data-item_id"),this.component_title=n.data("nav_title"),this._hide_disabled_products=n.hasClass("hide-incompatible-products"),this._hide_disabled_variations=n.hasClass("hide-incompatible-variations"),this._is_static=n.hasClass("static"),this.$component_summary=n.find(".component_summary"),this.$component_summary_content=n.find(".component_summary > .content"),this.$component_selections=n.find(".component_selections"),this.$component_content=n.find(".component_content"),this.$component_options=n.find(".component_options"),this.$component_filters=n.find(".component_filters"),this.$component_ordering=n.find(".component_ordering select"),this.$component_options_inner=n.find(".component_options_inner"),this.$component_inner=n.find(".component_inner"),this.$component_pagination=n.find(".component_pagination"),this.$component_message=n.find(".component_message"),this.$component_data=this.$component_summary_content.find(".component_data"),this.$component_quantity=this.$component_summary_content.find(".component_wrap input.qty"),this.$component_options_select=this.$component_options.find("select.component_options_select"),this.$component_thumbnail_options=this.$component_options.find(".component_option_thumbnails"),this.$component_radio_button_options=this.$component_options.find(".component_option_radio_buttons"),this.$component_content_scroll_target=n.find(".scroll_show_component_details"),this.$component_addons_totals=!1,this.show_addons_totals=!1,0===this.$component_content_scroll_target.length&&(this.$component_content_scroll_target=this.$component_content),this.append_results=function(){return"yes"===i.$composite_data.data("composite_settings").pagination_data[this.step_id].append_results},this.get_results_per_page=function(){return i.$composite_data.data("composite_settings").pagination_data[this.step_id].results_per_page},this.get_max_results=function(){return i.$composite_data.data("composite_settings").pagination_data[this.step_id].max_results},this.get_pagination_range=function(t){void 0===t&&(t="mid");var e="end"===t?"pagination_range_end":"pagination_range";return i.$composite_data.data("composite_settings").pagination_data[this.step_id][e]},this.get_relocation_mode=function(){return i.$composite_data.data("composite_settings").pagination_data[this.step_id].relocation_mode},this.get_selected_product=function(t,e){return void 0===t&&(t=!0),void 0===e&&(e=!1),t&&!this.is_selected_product_valid()?null:e&&!this.is_visible()?null:this.component_selection_model.get("selected_product")},this.get_selected_variation=function(t){return void 0===t&&(t=!0),t&&!this.is_selected_variation_valid()?null:this.component_selection_model.get("selected_variation")},this.get_selected_quantity=function(){return!1===s.is_visible()?0:this.component_selection_model.get("selected_quantity")},this.get_selected_product_type=function(){return this.$component_data.data("product_type")},this.get_selected_product_title=function(t,e){if(e=void 0!==e&&e,t=void 0!==t&&t,e&&!this.is_selected_product_valid())return"";var n=this.find_selected_product_param("title"),o=this.get_selected_quantity(),s=this.get_selected_product(!1),a="",_="",c="";return(n=i.filters.apply_filters("component_selection_title",[n,this]))&&t&&(""===s?a='<span class="content_product_title none">'+n+"</span>":(c=o>1?"<strong>"+wc_composite_params.i18n_qty_string.replace("%s",o)+"</strong>":"",a=wc_composite_params.i18n_title_string.replace("%t",n).replace("%q",c).replace("%p",""),(_=this.get_selected_product_meta(!0))&&(a=wc_composite_params.i18n_selected_product_string.replace("%t",a).replace("%m",_)),a='<span class="content_product_title">'+a+"</span>"),a=i.filters.apply_filters("component_selection_formatted_title",[a,n,o,_,this])),t?a:n},this.get_selected_product_meta=function(e){e=void 0!==e&&e;var n="",o=this.get_selected_variation(!1)>0?this.component_selection_model.selected_variation_data:[];return(o=i.filters.apply_filters("component_selection_meta",[o,this])).length>0&&e&&(n='<ul class="content_product_meta">',t.each(o,function(t,e){n=n+'<li class="meta_element"><span class="meta_key">'+e.meta_key+':</span> <span class="meta_value">'+e.meta_value+"</span>",t!==o.length-1&&(n+='<span class="meta_element_sep">, </span>'),n+="</li>"}),n+="</ul>",n=i.filters.apply_filters("component_selection_formatted_meta",[n,o,this])),e?n:o},this.get_selected_product_image_data=function(t){return!((t=void 0===t||t)&&!this.is_selected_product_valid())&&(this.get_selected_variation(t)>0&&this.component_selection_model.selected_variation_image_data?this.component_selection_model.selected_variation_image_data:this.component_selection_model.selected_product_image_data)},this.is_selected_product_valid=function(t){return void 0===t&&(t=this.component_options_model.get("active_options")),""===this.component_selection_model.get("selected_product")||_.contains(t,this.component_selection_model.get("selected_product"))},this.is_selected_variation_valid=function(t){return void 0===t&&(t=this.component_options_model.get("active_options")),""===this.component_selection_model.get("selected_variation")||_.contains(t,this.component_selection_model.get("selected_variation"))},this.has_valid_selections=function(t){t=void 0===t||t;var e=this.get_selected_product(t),n=this.get_selected_variation(t),o=this.get_selected_product_type(),s=!1;return""===e?(this.is_optional()||!1===t&&this.maybe_is_optional())&&(s=!0):e>0&&("variable"===o?(n>0||0===this.get_selected_quantity())&&(s=!0):"simple"===o||"none"===o?s=!0:0===this.get_selected_quantity()&&(s=!0)),this.is_visible()||(s=!0),i.filters.apply_filters("component_is_valid",[s,t,this])},this.hide_disabled_products=function(){return i.filters.apply_filters("component_hide_disabled_products",[this._hide_disabled_products,this])},this.hide_disabled_variations=function(){return i.filters.apply_filters("component_hide_disabled_variations",[this._hide_disabled_variations,this])},this.find_selected_product_param=function(e){if("id"===e)return i.console_log("error","\nMethod 'WC_CP_Component::find_selected_product_param' was called with a deprecated argument value ('id'). Use 'WC_CP_Component::get_selected_product' instead."),this.get_selected_product(!1);if("variation_id"===e)return"variable"===this.get_selected_product_type()?this.$component_summary_content.find(".single_variation_wrap .variations_button input.variation_id").val():"";if("title"===e){var n=this.get_selected_product(!1),o="";return""===n?o=wc_composite_params.i18n_no_selection:""!==n&&this.component_options_model.available_options_data.length>0&&t.each(this.component_options_model.available_options_data,function(t,e){if(e.option_id===n)return o=e.option_title,!1}),o}if("variation_data"===e){var s=this.$component_summary_content.find(".variations");return s.length>0?wc_cp_get_variation_data(s,!1):[]}if("product_image_data"===e){var a=this.$component_data.data("custom"),_=!1;return a&&void 0!==a.image_data&&(_={image_src:a.image_data.image_src,image_srcset:a.image_data.image_srcset,image_sizes:a.image_data.image_sizes,image_title:a.image_data.image_title}),_}if("variation_image_data"===e){var c=this.find_selected_product_param("variation_id"),d=this.$component_data.data("product_variations"),r=!1;return c>0&&d&&t.each(d,function(t,e){if(parseInt(e.variation_id)===parseInt(c))return e.image?r={image_src:e.image.src,image_srcset:e.image.srcset,image_sizes:e.image.sizes,image_title:e.image.title}:e.image_src&&(r={image_src:e.image_src,image_srcset:e.image_srcset,image_sizes:e.image_sizes,image_title:e.image_title}),!1}),r}if("quantity"===e){var l=this.$component_quantity.length>0?this.$component_quantity.val():0;return parseInt(l)}if("addons_price"===e){var p=this.has_addons()?this.$component_addons_totals.data("addons-raw-price"):0;return Number(p)}if("nyp_price"===e){var u=this.$component_summary_content.find(".nyp"),m=u.length>0?u.data("price"):0;return Number(m)}},this.find_pagination_param=function(t){var e=s.$component_pagination.first().data("pagination_data"),i=1;return e&&("page"===t?i=e.page:"pages"===t&&(i=e.pages)),i},this.find_order_by=function(){var t="";return this.$component_ordering.length>0&&(t=this.$component_ordering.val()),t},this.find_active_filters=function(){var e=this.$component_filters,i={};return 0==e.length?i:(e.find(".component_filter_option.selected").each(function(){var e=t(this).closest(".component_filter").data("filter_type"),n=t(this).closest(".component_filter").data("filter_id"),o=t(this).data("option_id");e in i?n in i[e]?i[e][n].push(o):(i[e][n]=[],i[e][n].push(o)):(i[e]={},i[e][n]=[],i[e][n].push(o))}),i)},this.find_options_data=function(){return s.$component_options.data("options_data")},this.is_in_stock=function(){var t=!0;return this.$component_summary_content.find(".component_wrap .out-of-stock").not(".inactive").length>0&&this.get_selected_quantity()>0&&("variable"!==this.get_selected_product_type()||this.get_selected_variation(!1)>0)&&(t=!1),t},this.is_nyp=function(){return this.component_selection_model.get("selected_nyp")>0},this.has_options_style=function(t){return this.$el.hasClass("options-style-"+t)},this.get_bundle_script=function(){var t=!1;return void 0!==wc_pb_bundle_scripts[s.component_id]&&(t=wc_pb_bundle_scripts[s.component_id]),t},this.has_addons=function(){return this.$component_addons_totals&&this.$component_addons_totals.length>0},this.init_scripts=function(e){if(void 0===e&&(e=!0),this.$component_data=this.$component_summary_content.find(".component_data"),this.$component_quantity=this.$component_summary_content.find(".component_wrap input.qty"),this.$component_addons_totals=!1,this.show_addons_totals=!1,e){s.initializing_scripts=!0,s.init_qty_input();var n=this.get_selected_product_type(),o=this.$component_summary_content;this.$component_addons_totals="bundle"===n?o.find(".bundle_data #product-addons-total"):o.find("#product-addons-total"),this.has_addons()?1==this.$component_addons_totals.data("show-sub-total")&&(this.$component_addons_totals.data("show-sub-total",0),this.show_addons_totals=!0):this.$component_addons_totals=!1,"variable"===n?(o.hasClass("cart")||o.addClass("cart"),o.hasClass("variations_form")||o.addClass("variations_form"),o.data("product_variations",this.$component_data.data("product_variations")),t.each(this.$component_data.data("product_variations"),function(t,e){s.component_options_model.attributes.active_options.push(e.variation_id.toString()),s.component_options_model.attributes.options_state.active.push(e.variation_id.toString())}),o.wc_variation_form(),o.find(".variations select").change(),o.find("div").stop(!0,!0)):"bundle"===n?(o.hasClass("bundle_form")||o.addClass("bundle_form"),o.find(".bundle_data").wc_pb_bundle_form(),o.find("div").stop(!0,!0)):o.hasClass("cart")||o.addClass("cart"),s.initializing_scripts=!1}i.actions.do_action("component_scripts_initialized",[s])},this.reset_scripts=function(){s.$component_summary_content.removeClass("variations_form bundle_form cart"),s.$component_summary_content.off().find("*").off(),i.actions.do_action("component_scripts_reset",[s])},this.get_step=function(){return i.get_step(this.component_id)},this.is_static=function(){return this._is_static},this.is_optional=function(){var t=_.contains(this.component_options_model.get("active_options"),"");return i.filters.apply_filters("component_is_optional",[t,this])},this.maybe_is_optional=function(){return 0 in i.scenarios.get_scenario_data().scenario_data[s.component_id]},this.show_placeholder_option=function(){return"yes"===i.$composite_data.data("composite_settings").show_placeholder_option[this.step_id]},this.is_selected_product_price_visible=function(){return"yes"===i.$composite_data.data("composite_settings").selected_product_price_visibility_data[this.step_id]},this.is_subtotal_visible=function(){return"yes"===i.$composite_data.data("composite_settings").subtotal_visibility_data[this.step_id]},this.get_price_display_format=function(){return i.$composite_data.data("composite_settings").price_display_format_data[this.step_id]},this.get_formatted_option_price_html=function(t){var e=s.get_price_display_format(),n=t.option_price_html,o=t.option_price_data;if("relative"===e){var a=s.component_id,_=i.data_model.get("component_"+a+"_totals"),c=s.has_valid_selections(!1),d=!1;if(d=i.filters.apply_filters("formatted_option_price_show_absolute_if_selections_invalid",[d,o,this]),!1===c&&!1===d)n="";else if(!1===t.is_selected||!1===c){var r=c,l=r?_.price:0,p=parseFloat(o.price)-parseFloat(l),u=0,m=0,h=o.price<o.max_price||""===o.max_price,g=o.min_qty>1?wc_composite_params.i18n_per_unit_string:"",v="",f="",b="",w="";(0!==p||h)&&(f=s.get_formatted_price_html(p,r),s.has_options_style("dropdowns")?(o.regular_price>o.price&&(o.discount&&(v=wc_composite_params.i18n_discount_string.replace("%s",wc_cp_number_round(o.discount,1))),!v&&o.regular_price>o.price&&(v=wc_composite_params.i18n_discount_string.replace("%s",wc_cp_number_round(100*(o.regular_price-o.price)/o.regular_price,1))),v=i.filters.apply_filters("formatted_option_price_discount_suffix",[v,o,this])),h&&(""===o.max_price?f=wc_composite_params.i18n_price_from_string_plain.replace("%p",f):(0!==(m=parseFloat(o.max_price)-parseFloat(l))&&(w=s.get_formatted_price_html(m,r)),f=0!==p&&0!==m?wc_composite_params.i18n_price_range_string_plain.replace("%f",f).replace("%t",w):0===p?wc_composite_params.i18n_price_upto_string_plain.replace("%p",w):wc_composite_params.i18n_price_from_string_plain.replace("%p",f))),f=wc_composite_params.i18n_price_string.replace("%p",f).replace("%q",g).replace("%d",v)):(o.regular_price>o.price&&0!==(u=parseFloat(o.regular_price)-parseFloat(l))&&(b=s.get_formatted_price_html(u,r),f=wc_composite_params.i18n_strikeout_price_string.replace("%f",b).replace("%t",f)),h&&(""===o.max_price?f=wc_composite_params.i18n_price_from_string.replace("%p",f):(0!==(m=parseFloat(o.max_price)-parseFloat(l))&&(w=s.get_formatted_price_html(m,r)),f=!1===r?wc_composite_params.i18n_price_range_string_absolute.replace("%f",f).replace("%t",w):0!==p&&0!==m?wc_composite_params.i18n_price_range_string.replace("%f",f).replace("%t",w):0===p?wc_composite_params.i18n_price_upto_string.replace("%p",w):wc_composite_params.i18n_price_from_string.replace("%p",f))))),n=f}n||(s.has_options_style("thumbnails")?n="&nbsp;":s.has_options_style("radios")&&(n="&mdash;"))}return i.filters.apply_filters("formatted_option_price_html",[n,t,this])},this.get_formatted_price_html=function(t,e){var i="",n=wc_cp_price_format(Math.abs(t),s.has_options_style("dropdowns"));return(e=void 0!==e&&e)&&(i=t>=0?"+":"-"),i=i&&s.has_options_style("dropdowns")?i:'<span class="relative-price-prefix">'+i+"</span>",n=wc_composite_params.i18n_price_signed.replace("%s",i).replace("%p",n)},this.init_qty_input=function(){"yes"===wc_composite_params.show_quantity_buttons&&this.$component_summary_content.find("div.quantity:not(.buttons_added), td.quantity:not(.buttons_added)").addClass("buttons_added").append('<input type="button" value="+" class="plus" />').prepend('<input type="button" value="-" class="minus" />'),"yes"===i.settings.component_qty_restore&&this.$component_quantity.val(this.get_selected_quantity()),this.$component_quantity.trigger("change")},this.get_placeholder_image_data=function(){return void 0!==i.$composite_data.data("composite_settings").image_data[this.step_id]&&i.$composite_data.data("composite_settings").image_data[this.step_id]},this.get_selected_product_id=function(){return this.find_selected_product_param("id")}}this.create_component=function(t,n,o){return i.prototype=this.create(e.prototype),i.prototype.constructor=i,new i(t,n,o)},this.create_step=function(t,i,n){return i.hasClass("component")?this.create_component(t,i,n):new e(t,i,n)},this.create=function(t){function e(){}return e.prototype=t,new e}},$wc_cp_document.ready(function(){($wc_cp_body=t(document.body)).on("quick-view-displayed",function(){t(".quick-view .composite_form .composite_data").each(function(){t(this).wc_composite_form()})}),$wc_cp_window.resize(function(){t.each(wc_cp_composite_scripts,function(t,e){clearTimeout(e.timers.on_resize_timer),e.timers.on_resize_timer=setTimeout(function(){e.on_resize_handler()},50)})}),t.fn.wc_composite_form=function(){if(!t(this).hasClass("composite_data"))return!0;var e=t(this).data("container_id"),n=t(this).closest(".composite_form");void 0!==wc_cp_composite_scripts[e]&&(n.find("*").off(),t.each(wc_cp_composite_scripts[e].get_components(),function(t,e){e.reset_scripts()})),wc_cp_composite_scripts[e]=new i({$composite_form:n,$composite_data:t(this)}),n.data("script_id",e),wc_cp_composite_scripts[e].init()},t(".composite_form .composite_data").each(function(){t(this).wc_composite_form()})})}(jQuery,Backbone);